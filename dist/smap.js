var smap={core:{},event:$("<div />"),copyright:"© 2014 Malmö stad, Kristianstad kommun, Helsingborg stad, Lunds kommun"};smap.core.Div=L.Class.extend({initialize:function(){this.parentTag=$("body"),this.draw()},draw:function(){var t=$('<div id="mapdiv" />'),e=$('<div id="maindiv" />');e.append(t),this.parentTag.append(e),L.Browser.touch&&$(window).on("orientationchange",function(){window.scrollTo(0,0)}),smap.event.on("smap.core.pluginsadded",function(){($("body > header").length||smap.cmd.getControl("MalmoHeader"))&&e.addClass("map-with-header")})},CLASS_NAME:"smap.core.Div"}),smap.core.Init=L.Class.extend({_selectedFeatures:[],initialize:function(){this.defineProjs(),smap.core.divInst=new smap.core.Div,smap.cmd.loading(!0),this.init()},init:function(t){t=t||{};var e=this;this.drawMap(),this.bindEvents(this.map),smap.core.layerInst=new smap.core.Layer(this.map),smap.core.selectInst=new smap.core.Select(this.map),smap.core.paramInst=new smap.core.Param(this.map),smap.core.pluginHandlerInst=new smap.core.PluginHandler(this.map);var n=t.params||smap.core.paramInst.getParams();this.loadConfig(n.CONFIG).done(function(){smap.config=config||window.config,smap.config.configName=n.CONFIG;var t=n.LANG||navigator.language;smap.config.langCode=t?t.split("-")[0]:"en",n=$.extend(utils.objectToUpperCase(smap.config.params||{}),n),e.applyConfig(smap.config),smap.core.paramInst.applyParams(n),smap.cmd.loading(!1)}).fail(function(t,e){utils.log("Config not loaded because: "+e),smap.cmd.loading(!1)})},applyConfig:function(t){this.preProcessConfig(t);var e=smap.config.ws.proxy;L.GeoJSON.WFS.prototype.proxy=e,L.GeoJSON.Custom.prototype.proxy=e,L.Control.SelectWMS.prototype.proxy=e,$.extend(this.map.options,t.mapOptions||{}),smap.core.pluginHandlerInst.addPlugins(t.plugins)},resetMap:function(){smap.map.off();for(var t=smap.core.controls,e=0,n=t.length;n>e;e++)try{smap.map.removeControl(t[e])}catch(a){}this.map.remove(),this.map=null,delete this.map,smap.map=null,delete smap.map,window.config=null;try{delete window.config}catch(a){}smap.config=null,delete smap.config,smap.event.off(),smap.core.controls=[],smap.core.layerInst=null,smap.core.modInst=null,smap.core.paramInst=null,delete smap.core.layerInst,delete smap.core.modInst,delete smap.core.paramInst},bindEvents:function(){},drawMap:function(t){t=t||{},L.Browser.touch&&L.Browser.ie&&(t.tapTolerance=30);var e=smap.core.mainConfig.mapConfig||{};this.map=L.map("mapdiv",$.extend(e,t)),smap.map=this.map},loadConfig:function(t){return t=t||"config.js",$.ajax({url:"configs/"+t,context:this,dataType:"script"})},preProcessConfig:function(t){t.ws&&t.ws.hasOwnProperty(document.domain)?t.ws=t.ws[document.domain]:utils.log("config.ws does not support this domain: "+document.domain);for(var e=t.bl||[],n=0,a=e.length;a>n;n++)e[n].options.isBaseLayer=!0},defineProjs:function(){window.proj4&&(proj4=window.proj4,proj4.defs([["EPSG:4326","+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"],["EPSG:3857","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"],["EPSG:3008","+proj=tmerc +lat_0=0 +lon_0=13.5 +k=1 +x_0=150000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3006","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:3021","+proj=tmerc +lat_0=0 +lon_0=15.8062845294444 +k=1.00000561024+x_0=1500064.274 +y_0=-667.711 +ellps=GRS80 +units=m"]]))},CLASS_NAME:"smap.core.Init"}),$(document).ready(function(){smap.core.initInst=new smap.core.Init}),smap.core.Layer=L.Class.extend({options:{defaultStyle:{color:"#00F",fillColor:"#00F",opacity:1,fillOpacity:.3,radius:8,weight:1},selectStyle:{weight:5,color:"#00DDFF",dashArray:"",fillOpacity:.8,strokeOpacity:1}},_layers:{},_bindEvents:function(){var t=this.map;this._onLayerAdd=this._onLayerAdd||$.proxy(this.onLayerAdd,this),this._onLayerRemove=this._onLayerRemove||$.proxy(this.onLayerRemove,this),t.on("layeradd",this._onLayerAdd),t.on("layerremove",this._onLayerRemove),smap.event.on("smap.core.applyparams",$.proxy(function(e,n){var a;if(a=n.BL?smap.cmd.getLayerConfig(n.BL):smap.config.bl[0],a&&a.options&&(a.options.isBaseLayer=!0,t.addLayer(this._createLayer(a))),n.OL){var o,i=n.OL instanceof Array?n.OL:n.OL.split(",");for(o=0,len=i.length;len>o;o++)this._addLayerWithConfig(smap.cmd.getLayerConfig(i[o]))}},this))},initialize:function(t){this.map=t,this._bindEvents()},addOverlays:function(t){this._addLayers(t)},_addLayers:function(t){t=t||[];var e,n;for(e=0,len=t.length;len>e;e++)n=t[e],this._addLayerWithConfig(n)},_addLayerWithConfig:function(t){if(!t||!t.options)return!1;var e=this._createLayer(t);return e?(this.map.addLayer(e),e):!1},onLayerAdd:function(t){var e=t.layer;if(e.options&&e.options.layerId&&!e.feature&&(e._tileContainer||e._layers)){var n=e.options.layerId;this._layers[n]=e,e._layers&&this._wfsLayers.push(e)}},onLayerRemove:function(t){var e=t.layer;e._layers&&this._wfsLayers.splice(e,1)},_getLayer:function(t){return this._layers[t]||null},_wfsLayers:[],_createLayer:function(t){var layerAlreadyAdded=this._getLayer(t.options.layerId);if(layerAlreadyAdded)return layerAlreadyAdded;var init=eval(t.init);t.options.zIndex=t.options.isBaseLayer?t.options.zIndex||0:t.options.zIndex||10;var layer=new init(t.url,t.options),self=this;return layer._layers?(layer.options.style=layer.options.style||$.extend({},self.options.defaultStyle),layer.on("load",function(){smap.cmd.loading(!1)}),layer.on("loadcancel loaderror",function(){smap.cmd.loading(!1)})):layer.on("load",function(){smap.cmd.loading(!1)}),layer.on("loading",function(){smap.cmd.loading(!0)}),layer},showLayer:function(t){var e=t instanceof Object?t:smap.cmd.getLayerConfig(t),n=this._getLayer(t);return n||(n=this._createLayer(e)),this.map.hasLayer(n)===!1&&this.map.addLayer(n),n},hideLayer:function(t){var e=this._getLayer(t);e.fire("loadcancel",{layer:this}),this.map.removeLayer(e)},CLASS_NAME:"smap.core.Layer"}),smap.core.Param=L.Class.extend({initialize:function(t){this.map=t},_lang:{sv:{remove:"Ta bort"},en:{remove:"Remove"}},_setLang:function(){langCode=smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[langCode]:null)},getParams:function(){for(var t,e,n,a="?",o=location.href.split(a),i=o.length>1?o[1]:"",s={},r=i.split(/[&;]/),l=0,c=r.length;c>l;l++)if(n=r[l].split("="),n[0]){t=n[0];try{t=decodeURIComponent(t)}catch(p){t=unescape(t)}e=(n[1]||"").replace(/\+/g," ");try{e=decodeURIComponent(e)}catch(p){e=unescape(e)}e=e.split(","),1==e.length&&(e=e[0]),s[t.toUpperCase()]=e}return s},createParamsAsObject:function(){var t,e,n,a=this.map.getCenter(),o=this.map._layers,i=[];for(var s in o)e=o[s],e&&e.options&&e.options.layerId&&(n=e.options.layerId,e.options.isBaseLayer?t=n:-1===$.inArray(e.options.layerId,i)&&i.push(n));var r={zoom:this.map.getZoom(),center:[utils.round(a.lng,5),utils.round(a.lat,5)],ol:i,bl:t};return smap.config.configName&&(r.config=smap.config.configName),smap.event.trigger("smap.core.createparams",r),r},createParams:function(t){t=t||!1;var e,n=this.createParamsAsObject(),a="";for(var o in n){if(e=n[o],e instanceof Array){if(!e.length)continue;e=e.join(",")}a+="&"+o+"="+e}return a=a.substring(1),t===!0&&(a=document.URL.split("?")[0]+"?"+a),a},applyParams:function(t){t=t||{};var e=this;this._setLang();var n=t.ZOOM?parseInt(t.ZOOM):0,a=t.CENTER?L.latLng([parseFloat(t.CENTER[1]),parseFloat(t.CENTER[0])]):null;if(n||0===n||(n=this.map.options.minZoom||0),a?this.map.setView(a,n,{animate:!1}):this.map.fitWorld(),t.XY){var o=L.marker(L.latLng(parseFloat(t.XY[1]),parseFloat(t.XY[0])));if(this.map.addLayer(o),t.XY.length>2){var i="<p>"+t.XY[2]+'</p><button class="btn btn-default smap-core-btn-popup">'+this.lang.remove+"</button>";o.bindPopup(i).openPopup(),$(".smap-core-btn-popup").on("click",function(){e.map.removeLayer(o)})}}smap.event.trigger("smap.core.applyparams",t)},CLASS_NAME:"smap.core.Param"}),smap.core.PluginHandler=L.Class.extend({initialize:function(t){this.map=t;var e=this;smap.event.on("smap.core.pluginsadded",function(){e._processQueue()})},getPlugin:function(){for(var t,e=smap.core.controls||[],n=0,a=e.length;a>n;n++)if(t=e[n],t instanceof L.Control[controlName])return t;return null},addPlugins:function(arr){var t,init,autoActivates=[];smap.core.controls=smap.core.controls||[];for(var i=0,len=arr.length;len>i;i++)t=arr[i],init=eval(t.init),init&&(init=new init(t.options||{}),this.map.addControl(init),smap.core.controls.push(init),init.options.autoActivate&&autoActivates.push(init));smap.event.trigger("smap.core.pluginsadded"),smap.event.pluginsadded=!0;for(var i=0,len=autoActivates.length;len>i;i++)autoActivates[i].activate()},_callQueue:[],callPlugin:function(t,e,n,a){n=n||[];var o=L.Control[t];smap.event.pluginsadded?this._callPlugin(o,e,n,a):this._callQueue.push([o,e,n,a])},_callPlugin:function(t,e,n,a){if(!t)return null;for(var o,i=smap.core.controls||[],s=null,r=0,l=i.length;l>r;r++)if(o=i[r],o instanceof t){s=o[e].apply(o,n||[]);break}return a?a(s):s},_processQueue:function(){var t,e,n,a=this._callQueue||[];for(e=0,len=a.length;len>e;e++)t=a[e],n=this._callPlugin.apply(this,t);return this._callQueue=[],n},CLASS_NAME:"smap.core.PluginHandler"}),smap.core.Select=L.Class.extend({_selectedFeaturesVector:[],_selectedFeaturesWms:[],initialize:function(t){this.map=t,this._bindEvents(t),this._wfsLayers=smap.core.layerInst._wfsLayers},_getVectorVal:function(t,e){var n,t=t||{};if(paramVal=null,e.split(";").length>1){var a=e.split(";");n=t[a[0]]+";"+t[a[1]]}else n=t[e];return n},_setSelectStyle:function(t){var e=t.target;e.setStyle&&e.setStyle(this.options.selectStyle),!e.bringToFront||L.Browser.ie||L.Browser.opera||e.bringToFront()},_resetStyle:function(t){t.eachLayer(function(e){t.resetStyle(e)})},_bindEvents:function(t){var e=this;t.on("click",function(){for(var n=e._wfsLayers,a=0,o=n.length;o>a;a++)e._resetStyle(n[a]);t.fire("unselected",{})}),t.on("unselected",function(t){t.feature?$.each(e._selectedFeaturesVector,function(n,a){return t.feature.id===a.id?(e._selectedFeaturesVector.splice(n,1),!1):void 0}):(e._selectedFeaturesVector=[],e._selectedFeaturesWms=[])}),t.on("selected",function(n){var a=n.layer,o=a.hasOwnProperty("_layers"),i=(a.options.layerId,n.feature),s=n.selectedFeatures||[],r=(a.options.uniqueKey||"-",n.shiftKeyWasPressed),l=n.latLng,c=i.properties;if(o?(e._selectedFeaturesWms=[],r?(e._selectedFeaturesVector=utils.makeUniqueArr(e._selectedFeaturesVector.concat(s)),$.each(e._wfsLayers,function(t,e){e.eachLayer(function(t){t.unbindPopup&&t.unbindPopup(),t._layers&&$.each(t._layers,function(t,e){e.unbindPopup&&e.unbindPopup()})})})):e._selectedFeaturesVector=[].concat(s)):(e._selectedFeaturesVector=[],e._selectedFeaturesWms=utils.makeUniqueArr(e._selectedFeaturesWms.concat(s))),o&&!r&&e._selectedFeaturesVector.length<=1){for(var p,d=e._wfsLayers,u=0,h=d.length;h>u;u++)p=d[u],p!==a&&(p.resetStyle(p),p._selectedFeatures=[]);var m=utils.extractToHtml(a.options.popup,c),p=utils.getLayerFromFeature(i,a);p._popup&&p.unbindPopup(),p.bindPopup(m,{autoPan:!0,keepInView:!1,autoPanPadding:L.point(0,50)}),p.openPopup(l)}if(!o&&l){for(var f in c);var g=f.split(":"),v=g[g.length-1],_=smap.cmd.getLayerConfigBy("layers",v,{inText:!0});if(!_)return!1;c=c[f][0],c._displayName=_.options.displayName;var m=utils.extractToHtml(_.options.popup,c);m=m.replace("${_displayName}",_.options.displayName);var y=$("<div>"+m+"</div>");y.find("a").each(function(){var t=$(this).attr("href"),e=$(this).text(),n=$('<button class="btn btn-default btn-sm">'+e+"</button>");n.attr("onclick",'window.open("'+t+'", "_blank")'),$(this).after(n),$(this).remove(),m=y.html()}),t.closePopup();{L.popup().setLatLng(l).setContent(m).openOn(t)}}}),smap.event.on("smap.core.createparams",function(t,n){function a(t,e,n){r[t]||(r[t]={}),r[t][e]||(r[t][e]=[]),r[t][e].push(n)}var o,i,s,r={};if(e._selectedFeaturesVector&&e._selectedFeaturesVector.length){s=e._selectedFeaturesVector;for(var l=0,c=s.length;c>l;l++)o=s[l],i=e._getVectorVal(o.properties,o.uniqueKey),a(o.layerId,"vals",i),r[o.layerId].key=o.uniqueKey}if(e._selectedFeaturesWms&&e._selectedFeaturesWms.length){s=e._selectedFeaturesWms;for(var l=0,c=s.length;c>l;l++)o=s[l],i=[o.latLng.lng,o.latLng.lat],a(o.layerId,"xy",i)}$.isEmptyObject(r)===!1&&(n.sel=encodeURIComponent(JSON.stringify(r)))}),smap.event.on("smap.core.applyparams",$.proxy(function(t,e){function n(){var t,e,o,i,l,c,p=this,d=this.options.layerId,u=this.options.uniqueKey,h=s[d],m=h.vals;for(o=0,len=m.length;len>o;o++)e=m[o],t=null,$.each(p._layers,function(n,a){if(a.feature){if(i=a.feature.properties,u.split(";").length>1?(l=u.split(";"),c=i[l[0]]+";"+i[l[1]]):c=a.feature.properties[u],!c)return!1;if(c===e)return t=a,!1}}),t&&t.fire("click",{properties:t.feature.properties,latlng:a,originalEvent:{shiftKey:r}});p.off("load",n)}if(e.SEL){var a,o,i,s=JSON.parse(decodeURIComponent(e.SEL)),r=!1,l=0;for(var c in s)if(l+=1,l>1||s[c].vals||s[c].vals.length>1){r=!0;break}for(i in s)o=s[i],o.key&&smap.core.layerInst.showLayer(i).on("load",n)}}))}}),smap.cmd={addToolButton:function(t,e,n,a){a=a||{index:null,toggle:!1,callback:null},smap.core.pluginHandlerInst.callPlugin(smap.core.mainConfig.toolbarPlugin,"addButton",[t,e,n,a])},createParams:function(t){return smap.core.paramInst.createParams(t)},createParamsAsObject:function(){return smap.core.paramInst.createParamsAsObject()},getControl:function(t){var e=this.getControls(t);return e.length?e[0]:null},getControls:function(t){t.search(/\./)>-1&&(t=t.split(".").slice(2).join("."));for(var e,n=smap.core.controls||[],a=[],o=0,i=n.length;i>o;o++)e=n[o],e instanceof L.Control[t]&&a.push(e);return a},notify:function(t,e,n){switch(n=n||{},n.parent=n.parent||$("body"),e){case"success":e="alert-success";break;case"error":e="alert-danger"}var a=$('<div class="alert '+e+' alert-dismissable"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+t+"</div>");return n.parent.find(".alert").remove(),n.parent.append(a),a},addLayerWithConfig:function(t){return smap.core.layerInst._addLayerWithConfig(t)},getLayer:function(t){return smap.core.layerInst._getLayer(t)},getLayerConfig:function(t){return this.getLayerConfigBy("layerId",t)},getLayerConfigBy:function(t,e,n){n=n||{};var a,o,i=smap.config.bl.concat(smap.config.ol||[]);for(a=0,len=i.length;len>a;a++){o=i[a];var s=o.options[t];if(n.inText){if(void 0!==s&&s.search(e)>-1)return o}else if(void 0!==s&&s===e)return o}return null},reloadCore:function(t){t=t||{},smap.core.initInst.resetMap(),smap.core.initInst.init(t)},loading:function(t){var e={sv:{loading:"laddar"},en:{loading:"loading"}},n=smap.config?smap.config.langCode:navigator.language,a=n?n.split("-")[0]:"en";if(this.lang=e?e[a]:null,t&&t===!0){if(!this.spinner){var o={lines:12,length:4,width:6,radius:25};this.spinner=new Spinner(o).spin()}this.spinner.spin(),$("#mapdiv").append(this.spinner.el),$("div .spinner").css({top:"auto",left:"3.5em",bottom:"3.5em"}),$(this.spinner.el).append('<div id="loadingText">'+this.lang.loading+"</div>")}else this.spinner.stop()}},smap.core.mainConfig={mapConfig:{layers:[],crs:L.CRS.EPSG3857,attributionControl:!0,zoomControl:!1,center:[0,0],zoom:2,maxZoom:18},toolbarPlugin:"Menu",defaultTheme:"smap"};var utils={rmPx:function(t){return parseInt(t.replace(/px/gi,"").replace(/em/gi,"").replace(/pt/gi,""))},log:function(){window.console},makeUniqueArr:function(t){var e=[];return $.each(t,function(t,n){-1===$.inArray(n,e)&&e.push(n)}),e},objectToUpperCase:function(t){var e={};for(var n in t)e[n.toUpperCase()]=t[n];return e},drawDialog:function(t,e,n,a){a=a||{},a.size=a.size||"";var o=$('<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'+(-1===t.search(/</g)?'<h4 class="modal-title">'+t+"</h4>":t)+'</div><div class="modal-body"></div></div>');if(o.find(".modal-body").append(e),n){var i=$('<div class="modal-footer"></div>');o.find(".modal-body").after(i),i.append(n)}return a.size&&(o.addClass("bs-modal-"+a.size),o.find(".modal-dialog").addClass("modal-"+a.size)),o},getLayerFromFeature:function(t,e){var n=e._layers;for(var a in n){var o=n[a];if(o.feature.id===t.id)return o}return null},round:function(t,e){var n=Math.pow(10,e||0);return Math.round(t*n)/n},makeUnselectable:function(t){t.attr("unselectable","unselectable").addClass("unselectable")},extractToHtml:function(html,props){function getFunctionEnd(t){var e=1,n=!1,a=t.search(/\{/g);t=t.substring(a+1);var o=0;for(o=0,len=t.length;len>o;o++)if("{"===t.charAt(o)?e+=1:"}"===t.charAt(o)&&(e-=1),0===e){n=!0,o=o+a+2;break}return n||(o=-1),o}function extractAttribute(a,txt){var index=txt.search(/\${/g);if(-1!==index){var extractedAttribute="",attr=html.substring(index+2),endIndex=0;if(endIndex="function"===attr.substring(0,8)?getFunctionEnd(attr):attr.search(/\}/g),attr=attr.substring(0,endIndex),"function"===attr.substring(0,8)){var theFunc=attr.replace("function","function f");eval(theFunc),extractedAttribute=f.call(this,a)}else extractedAttribute=a[attr]||"";txt=txt.replace("${"+attr+"}",extractedAttribute)}return txt}if("undefined"==typeof html)return html=null;for(var index=html.search(/\${/g);-1!==index;)html=extractAttribute(props,html),index=html.search(/\${/g);return html}};L.Control.Add2HomeScreen=L.Control.extend({options:{},initialize:function(t){L.setOptions(this,t),$("body").append('<script src="dist/lib/add-to-homescreen/src/addtohomescreen.js"></script>')},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-add2HomeScreen"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._container},onRemove:function(){}}),L.control.add2HomeScreen=function(t){return new L.Control.Add2HomeScreen(t)},L.Control.DrawSmap=L.Control.extend({options:{buttons:{polyline:{addToPopover:!0,iconCss:"icon-large icon-vector-path-line",displayName:"Polyline"},polygon:{addToPopover:!0,iconCss:"icon-large icon-vector-path-polygon",displayName:"Polygon"},rectangle:{addToPopover:!0,iconCss:"icon-large icon-vector-path-square",displayName:"Rectangle"},circle:{addToPopover:!0,iconCss:"icon-large icon-vector-path-circle",displayName:"Circle"},marker:{addToPopover:!0,iconCss:"icon-large icon-map-marker",displayName:"Marker"},edit:{addToPopover:!0,iconCss:"icon-large icon-edit",displayName:"Edit"},remove:{addToPopover:!0,iconCss:"icon-large icon-remove",displayName:"Remove"}}},_lang:{sv:{caption:"rita",close:"Stäng",btntitle:"rita",lineTitle:"Rita en linje.",lineStart:"Klicka i kartan för att börja rita en linje.",lineCont:"Rita linje",lineEnd:"Rita linje",polylineTooltip:"hej",polygonTitle:"Rita figur",rectangleTitle:"Rita linje",circleTitle:"Rita cirkel",markerTitle:"Markör",editTooltip:"Ändra genom att dra i brytpunkter, eller markör.",rmDisabledTitle:"Inget att radera.",rmEnabledTitle:"Radera figur(er).",rmTooltip:"Klicka på en figur för att ta bort den."},en:{caption:"draw",close:"Close",btntitle:"Draw",lineTitle:"Draw a line.",polygonTitle:"Draw a polygon.",rectangleTitle:"Draw a rectangle.",circleTitle:"Draw a circle.",circleTooltip:"Click and drag to draw a circle.",markerTitle:"Draw a marker.",markerTooltip:"Click map to place a marker.",editDisabledTitle:"Nothing to edit.",editEnabledTitle:"Edit object(s).",editTooltip:"Drag handles, or marker, to edit objects.",editTooltipSub:"Click cancel-button to undo changes.",editSaveTxt:"Save it!",editSaveTooltip:"Save ur changes",editCancelTxt:"Cancel",editCancelTooltip:"Cancel this!",rmDisabledTitle:"Nothing to delete.",rmEnabledTitle:"Delete object(s).",rmTooltip:"Click an object to delete it."}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},setTexts:function(){var t=L.drawLocal,e=this.lang;t.draw.toolbar.buttons.polyline=e.lineTitle,t.draw.toolbar.buttons.polygon=e.polygonTitle,t.draw.toolbar.buttons.rectangle=e.rectangleTitle,t.draw.toolbar.buttons.circle=e.circleTitle,t.draw.handlers.circle.tooltip.start=e.circleTooltip,t.draw.toolbar.buttons.marker=e.markerTitle,t.draw.handlers.marker.tooltip.start=e.markerTooltip,t.edit.toolbar.buttons.editDisabled=e.editDisabledTitle,t.edit.toolbar.buttons.edit=e.editEnabledTitle,t.edit.handlers.edit.tooltip.text=e.editTooltip,t.edit.handlers.edit.tooltip.subtext=e.editTooltipSub,t.edit.toolbar.actions.save.text=e.editSaveTxt,t.edit.toolbar.actions.save.title=e.editSaveTooltip,t.edit.toolbar.actions.cancel.text=e.editCancelTxt,t.edit.toolbar.actions.cancel.title=e.editCancelTooltip,t.edit.toolbar.buttons.removeDisabled=e.rmDisabledTitle,t.edit.toolbar.buttons.remove=e.rmEnabledTitle,t.edit.handlers.remove.tooltip.text=e.rmTooltip},onAdd:function(){var t=this;return t._container=L.DomUtil.create("div","leaflet-control-drawsmap"),L.DomEvent.disableClickPropagation(t._container),t.$container=$(t._container),t.initDone=!1,t.currentTool={},t._createDrawTool(),t._container},activate:function(){},initDraw:function(t){var e=this;return e.featureGroup=L.featureGroup().addTo(smap.map),e.drawControl=new L.Control.Draw({position:"bottomright",draw:{marker:!1,polyline:!1,polygon:!1,rectangle:!1,circle:!1},edit:{edit:!1,remove:!1,featureGroup:e.featureGroup,selectedPathoptions:{maintainColor:!0,opacity:.3}}}),e.setTexts(),smap.map.on("draw:created",function(t){var n=(t.layerType,t.layer);n.on("click",function(){return 1==e.delModeOn&&(e.featureGroup.removeLayer(n),e.featureGroup.getLayers().length||($("#drawsmapremove").prop("disabled",!0),$("#drawsmapedit").prop("disabled",!0),e.currentTool.disable(),e.currentTool={},e.delModeOn=!1)),!1}),e.featureGroup.addLayer(n),$("#drawsmapremove").prop("disabled",!1),$("#drawsmapedit").prop("disabled",!1),e.currentTool={}}),smap.map.on("draw:edited",function(){}),$.each(e.options.buttons,function(n,a){if(a.addToPopover===!0){var o=e._createToolBtn(n,a);t.append(o)}}),t},_createToolBtn:function(t,e){var n=this;t.toLowerCase();var a=$('<button id="drawsmap'+t+'" class="btn btn-default btn-popover" title="'+e.displayName+'"><span></span></button>');switch(t=t.charAt(0).toUpperCase()+t.slice(1)){case"Polyline":var o=new L.Draw.Polyline(smap.map,n.drawControl.options.draw.polyline);break;case"Polygon":var o=new L.Draw.Polygon(smap.map,n.drawControl.options.polygon);break;case"Rectangle":var o=new L.Draw.Rectangle(smap.map,n.drawControl.options.rectangle);break;case"Circle":var o=new L.Draw.Circle(smap.map,n.drawControl.options.circle);break;case"Marker":var o=new L.Draw.Marker(smap.map,n.drawControl.options.marker);break;case"Edit":var o=new L.EditToolbar.Edit(smap.map,{featureGroup:n.drawControl.options.edit.featureGroup,selectedPathOptions:n.drawControl.options.edit.selectedPathOptions});n.featureGroup.getLayers().length||a.prop("disabled",!0);break;case"Remove":var o=new L.EditToolbar.Delete(smap.map,{featureGroup:n.drawControl.options.edit.featureGroup});n.featureGroup.getLayers().length||a.prop("disabled",!0);break;default:return}return a.on("click",function(){1==o.enabled()?(o.disable(),n.currentTool={},n.delModeOn=!1):("remove"==n.currentTool.type?n.delModeOn=!1:"",1==$.isEmptyObject(n.currentTool)?n.currentTool=o:n.currentTool.disable(),o.enable(),"remove"==o.type?n.delModeOn=!0:"",n.currentTool=o)}),a.find("span").addClass(e.iconCss),a},_createDrawTool:function(){var t=this,e=$('<button id="smap-drawsmap-btn" title="'+t.lang.btntitle+'" class="btn btn-default"><span class="icon-large  icon-th"></span></button>');t.$container.append(e),e.on("click",function(){var e=$(this);return e.data("bs.popover")?$(".drawsmap-popover").is(":visible")?$(".drawsmap-popover").hide():$(".drawsmap-popover").show():(e.popover({placement:"bottom",container:"body",title:t.lang.popoverTitle,trigger:"manual"}),e.on("shown.bs.popover",function(){if(!t.initDone){var e=$(".popover"),n=$(".popover-content");e.addClass("drawsmap-popover"),t.initDraw(n),t.initDone=!0}}),e.on("hidden.bs.popover",function(){}),e.popover("show")),!1})},onRemove:function(){}}),L.control.drawsmap=function(t){return new L.Control.DrawSmap(t)},L.Control.DrawWFST=L.Control.extend({options:{},_lang:{sv:{},en:{}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(){var t=this;return t._container=L.DomUtil.create("div","leaflet-control-drawwfst"),L.DomEvent.disableClickPropagation(t._container),t.$container=$(t._container),t._container},activate:function(){},onRemove:function(){}}),L.control.drawwfst=function(t){return new L.Control.DrawWFST(t)},L.Control.FullScreen=L.Control.extend({options:{position:"topright"},_lang:{sv:{btnExpand:"Visa i fullskärm",btnCompress:"Återställ"},en:{btnExpand:"Show in fullscreen",btnCompress:"Reset"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){this.map=t;var e=this;return this._container=L.DomUtil.create("div","leaflet-control-fullScreen"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),document.addEventListener(screenfull.raw.fullscreenchange,function(){e._updateButton()}),this._container},activate:function(){var t=document.getElementById("maindiv");screenfull.enabled&&screenfull.toggle(t)},_updateButton:function(){var t=this,e=$("#smap-fullscreen-btn");screenfull.isFullscreen?(e.find("span").addClass("fa-compress"),e.attr("title",t.lang.btnCompress)):(e.find("span").removeClass("fa-compress"),e.attr("title",t.lang.btnExpand))},onRemove:function(){},_createBtn:function(){var t=this;this.$btn=$('<button id="smap-fullscreen-btn" title="'+t.lang.btnExpand+'" class="btn btn-default"><span class="fa fa-expand"></span></button>'),this.$btn.on("click",function(){return t.activate(),!1}),this.$container.append(this.$btn)}}),L.control.fullScreen=function(t){return new L.Control.FullScreen(t)},L.Control.Geolocate=L.Control.extend({options:{position:"bottomright",locateOptions:{maxZoom:17,enableHighAccuracy:!0}},_lang:{sv:{errorGeolocate:"Kunde inte hitta din position",notSupported:"Din webbläsare stödjer inte geolokalisering"},en:{errorGeolocate:"The browser could not detect your position",notSupported:"Your browser does not support geolocation"}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-Geolocate"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawButton(),this._container},onRemove:function(){},_drawButton:function(){var t=$('<button id="smap-glocate-btn" class="btn btn-default"><span class="fa fa-location-arrow"></span></button>');this.$container.append(t),this.btn=t,t.on("click",$.proxy(function(){return this.active?this.deactivate():this.activate(),!1},this))},activate:function(){return this.active?!1:navigator.geolocation?(this.active=!0,this.btn.addClass("btn-primary"),smap.cmd.loading(!0),this.__onLocationFound=this.__onLocationFound||$.proxy(this._onLocationFound,this),this.__onLocationError=this.__onLocationError||$.proxy(this._onLocationError,this),this.__onDragStart=this.__onDragStart||$.proxy(this._onDragStart,this),this.map.on("locationfound",this.__onLocationFound),this.map.on("locationerror",this.__onLocationError),this.map.on("dragstart",this.__onDragStart),this.map.on("zoomstart",this.__onDragStart),void this._startLocate(this.options.locateOptions)):(smap.cmd.notify(this.lang.notSupported),!1)},deactivate:function(){return this.active?(this.active=!1,smap.cmd.loading(!1),this.btn.removeClass("btn-primary"),this.map.off("locationfound",this.__onLocationFound),this.map.off("locationerror",this.__onLocationError),this.map.off("dragstart",this.__onDragStart),this.map.off("zoomstart",this.__onDragStart),this._stopLocate(),void(this.marker&&(this.map.removeLayer(this.marker),this.marker=null))):!1},_startLocate:function(t){t=t||{};var e={watch:!0,setView:!0,enableHighAccuracy:!1};t=$.extend(e,t),this.map.locate(t)},_stopLocate:function(){this.map.stopLocate()},_onLocationFound:function(t){smap.cmd.loading(!1),this.marker=this.marker||L.userMarker(t.latlng,{pulsing:!0}).addTo(this.map),this.marker.setLatLng(t.latlng),this.marker.setAccuracy(t.accuracy)},_onLocationError:function(t){smap.cmd.loading(!1);var e=smap.cmd.notify(this.lang.errorGeolocate+": "+t.message,"error",{parent:$("body")});e.on("touchstart",function(){$("body").find(".alert").remove()}),this.deactivate()},_onDragStart:function(){this._stopLocate(),this._startLocate({setView:!1})}}),L.control.geolocate=function(t){return new L.Control.Geolocate(t)},L.Control.GuideIntroScreen=L.Control.extend({options:{autoActivate:!0,position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>',bgSrc:null,langs:{sv:"Svenska",en:"English"},words:{sv:{btnStartTour:"Starta turen"},en:{btnStartTour:"Start the tour"}},header:{sv:{title:"Promenadstaden",subHeaders:["Malmö museer, Science Center"]},en:{title:"The walking city",subHeaders:["Malmö museums, Science Center"]}},configs:[{configName:"guide-industri.js",disabledText:!1,sv:{title:"Industristaden",description:"Industrispåret guidar dig genom de gamla industrierna i Malmös innerstad."},en:{title:"The industrial city",description:"This tour guides you to some old industrial buildings of Malmö"}},{configName:"guide-vh.js",disabledText:!1,sv:{title:"Västra hamnen",description:"Västra hamnen guidar dig genom Malmös modernaste och fräsigaste stadsdel."},en:{title:"Western harbor",description:"This tour guides you through the most modern part of Malmö."}}]},initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this.map=t,this._container=L.DomUtil.create("div","leaflet-control-guideintroscreen"),L.DomEvent.disableClickPropagation(this._container);var e=this._makeContent("sv"),n=$('<div class="guide-introscreen" />');return n.append(e),this.options.euLogoSrc&&n.append('<img class="gintro-eulogo" src="'+this.options.euLogoSrc+'"></img>'),this.options.bgSrc&&n.prepend('<img class="gintro-bg gintro-bg-left" src="'+this.options.bgSrc+'"></img><img class="gintro-bg gintro-bg-right" src="'+this.options.bgSrc+'"></img>'),this.$container=n,this._container},onRemove:function(){this.deactivate(),this.$container.remove()},activate:function(){$("#maindiv").append(this.$container),$("#mapdiv").hide()},deactivate:function(){this.$container.detach(),$("#mapdiv").show()},_makeContent:function(t){for(var e=$('<div class="guide-content container" />'),n=this.options.words[t],a=this,o=function(){smap.cmd.loading(!0);var t=$(this).data("configName");return smap.map.removeControl(a),smap.cmd.reloadCore({params:{CONFIG:t}}),!1},i=this.options.header[t],s="",r=0,l=i.subHeaders.length;l>r;r++)s+='<p class="lead">'+i.subHeaders[r]+"</p>";var c=$('<div class="container" id="gintro-logo-container"></div>');this.options.munLogoSrc&&c.append('<img class="gintro-munlogo" src="'+this.options.munLogoSrc+'"></img>');var p,d='<div class="container"><h1 style="margin-bottom:20px;">'+i.title+"</h1>"+s+"</div>",u="btn-danger",h=this.options.langs,m="",f=$('<div style="margin-top:30px;" class="btn-group" />');for(var g in h)m=h[g],p=$('<button type="button" class="guideintro-btn-option btn btn-default">'+m+"</button>"),g===t&&p.addClass(u),p.data("langCode",g),f.append(p);e.append(d),c.children().length&&e.append(c),e.append(f);var v,_,y,b,w=this.options.configs,L=$('<div class="row" />');e.append(L);for(var r=0,l=w.length;l>r;r++){if(v=w[r],b=v.configName,_=v[t],y=$('<div class="gintro-box col-xs-6 col-md-4 col-lg-3 text-left"><h3>'+_.title+'</h3><div style="margin-bottom:20px;"><p class="lead text-muted">'+_.description+'</p><button class="btn btn-default btn-sm gintro-btn-configoption">'+n.btnStartTour+"</button></div></div>"),v.disabledText){var C=$('<div class="gintro-disbox"><label>'+v.disabledText+"</label></div>");
y.find("div").append(C),y.find("button").addClass("disabled"),y.addClass("disabled")}y.addClass("col-xs-offset-3 col-md-offset-1 col-lg-offset-1");var k=y.find("button");k.data("configName",b),L.append(y)}return e.find(".guideintro-btn-option").on("click",function(){var e=$(this).data("langCode");if(t!==e){$(this).addClass(u).siblings().removeClass(u).addClass("btn-default");var n=a._makeContent(e).children();$(".guide-content").empty().append(n)}return!1}),e.find(".gintro-btn-configoption").on("click",o),e}}),L.control.guideIntroScreen=function(t){return new L.Control.GuideIntroScreen(t)},L.Control.GuidePopup=L.Control.extend({options:{},initialize:function(t){L.setOptions(this,t),this._setLang()},_lang:{sv:{introHeader:"Info",mediaHeader:"Media",accessHeader:"Tillgänglighet",close:"Stäng",showMore:"Visa mer"},en:{introHeader:"About",mediaHeader:"Media",accessHeader:"Accessibility",close:"Close",showMore:"Read more"}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-guidepopup"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.__onPopupClick=this.__onPopupClick||$.proxy(this._onPopupClick,this),this._activate(),this._container},onRemove:function(){this._deactivate(),950>windowWidth?this.hideTheTag():this.showTheTag()},_onPopupClick:function(t){var e=$("#gp-btn-show").data("props"),n=this._getFeatureData(e[this.options.attrId]),a=n.tabMedia,o=n.tabIntro;if(o)this.createPopup(e);else if(a&&a instanceof Object){var i,s=this._makeMediaContent(a.mediaType,utils.extractToHtml(a.sources,e).split(","));"image"!==n.mediaType&&(i=utils.extractToHtml(n.fullScreenIntroPic,e)),this.showFullScreen(s,utils.extractToHtml(a.label,e),i)}return($(t.target).hasClass("gp-mediaicons")||$(t.target).parent().hasClass("gp-mediaicons"))&&$('[href="#gp-moreinfo"]').click(),!1},_onPopupOpen:function(t){if(t.popup._source.feature){var e=t.popup._source.feature.layerId;if(e!==this.options.layerId)return;var n=t.popup._source.feature.properties;t.popup.options.autoPanPaddingTopLeft=[0,60],$(".leaflet-popup-content").find(".gp-mediaicons").on("touchstart click",this.__onPopupClick);var a=this._getFeatureData(n[this.options.attrId]);if(a&&a instanceof Object){var o=$('<button style="margin-top:10px;" id="gp-btn-show" class="btn btn-default">'+this.lang.showMore+"</button>");$(".leaflet-popup-content").append(o),o.data("props",n),o.on("touchstart click",this.__onPopupClick)}}},_onPopupClose:function(t){$(t.popup._wrapper).off("touchstart",this.onPopupClick)},_activate:function(){var t=this,e={audio:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/120-headphones.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})},video:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/46-movie-2.png",iconSize:[20,25],iconAnchor:[10,12],popupAnchor:[0,-9]})},image:{icon:L.icon({iconUrl:"img/glyphish-icons/PNG-icons/121-landscape.png",iconSize:[22,21],iconAnchor:[11,10],popupAnchor:[0,-8]})}},n=smap.cmd.getLayerConfig(this.options.layerId);n.options.pointToLayer=function(n,a){{var o=n.properties||{},i=t.options.modalContentOverrides[o[t.options.attrId]]||{};i.tabMedia}return i.iconType&&e[i.iconType]?L.marker(a,e[i.iconType]):L.marker(a)};smap.cmd.addLayerWithConfig(n);this.__onPopupOpen=this.__onPopupOpen||$.proxy(this._onPopupOpen,this),this.__onPopupClose=this.__onPopupClose||$.proxy(this._onPopupClose,this),this.map.on("popupopen",this.__onPopupOpen),this.map.on("popupclose",this.__onPopupClose)},_deactivate:function(){this.map.off("popupopen",this.__onPopupOpen),this.map.off("popupclose",this.__onPopupClose)},_makeCarousel:function(t){t=t||[];for(var e,n=$('<div id="guide-carousel" class="carousel slide">'),a=$('<ol class="carousel-indicators" />'),o=$('<div class="carousel-inner" />'),i=$('<a class="left carousel-control" href="#guide-carousel" data-slide="prev"><span class="icon-prev"></span></a><a class="right carousel-control" href="#guide-carousel" data-slide="next"><span class="icon-next"></span></a>'),s=0,r=t.length;r>s;s++)e=t[s],a.append('<li data-target="#guide-carousel" data-slide-to="'+s+'"></li>'),o.append('<div class="item"><img src="'+e+'"></img></div>');return o.find(".item:first").add(a.find("li:first")).addClass("active"),n.append(a).append(o).append(i),n.swiperight(function(){$(this).carousel("prev")}).swipeleft(function(){$(this).carousel("next")}),$(document).on("orientationchange",function(){var t=window.innerHeight;$(".gp-fullscreen").height(t)}),n},_makeAudioTag:function(t){t=t||[];for(var e,n,a,o,i=$('<audio controls="controls" />'),s=0,r=t.length;r>s;s++){switch(e=t[s],n=e.substring(e.length-3).toUpperCase()){case"OGG":a="audio/ogg";break;case"MP3":a="audio/mpeg"}o='<source src="'+e+'" type="'+a+'" />',i.append(o)}return i},_makeVideoTag:function(t){t=t||[];var e=$(window).width()-2,n=$(window).height()-65;if(n>e){var a=e;e=n,n=a}n/=2,e/=2;var o,i=t[0];return i.search(/youtu.be|youtube/i)>-1?o=$('<iframe src="'+i+'?rel=0" width="100%" height="80%" frameborder="0" allowfullscreen></iframe>'):i.search(/vimeo.com/i)&&(o=$('<iframe src="'+i+'" width="100%" height="80%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')),o},_makeAccessContent:function(t){var e=this._getFeatureData(t[this.options.attrId]);return utils.extractToHtml(e.tabAccess,t)},_makeMediaList:function(t,e){if(t=t||[],!t.length)return null;var n,a,o,i={image:"fa fa-picture-o fa-lg",audio:"fa fa-volume-up fa-lg",video:"fa fa-film fa-lg"},s=$('<div id="gp-listmoreinfo" class="list-group" />');for(a=0,len=t.length;len>a;a++)n=t[a],(!n.condition||n.condition&&n.condition(e)===!0)&&(o=$('<a href="#" class="list-group-item"><span class="'+i[n.mediaType]+'"></span>&nbsp;&nbsp;&nbsp;'+utils.extractToHtml(n.label,e)+"</a>"),s.append(o));return s.children().length?s:null},showFullScreen:function(t,e,n){function a(t){27===t.which&&o()}function o(){return $("body").off("keydown",a),$(".gp-fullscreen").removeClass("gp-fs-visible"),$(".gp-fullscreen").find("audio").each(function(){this.pause&&this.pause()}),setTimeout(function(){$(".gp-fullscreen").empty().remove()},500),!1}var i=$('<div class="gp-fullscreen"></div>');$("body").on("keydown",a);var s=$('<button type="button" class="btn btn-default">Stäng</button>');s.on("click",function(){return o(),!1});var r="<h1>"+e+"</h1>";if(i.append(r),n){var l=$('<img class="gp-mediapic" src="'+n+'" />');i.append(l)}i.append(t),i.append(s),s.css("z-index",3e3),$("body").append(i),setTimeout(function(){i.addClass("gp-fs-visible")},1)},_makeMediaContent:function(t,e){switch(t.toLowerCase()){case"image":content=this._makeCarousel(e);break;case"audio":content=this._makeAudioTag(e);break;case"video":content=this._makeVideoTag(e)}return content},_getFeatureData:function(t){var e=this.options.modalContentOverrides[t]||{};return $.extend(!0,{},this.options.modalContent||{},e)},createPopup:function(t){function e(){var e,a=$(this).index(),i=o.tabMedia[a],s=utils.extractToHtml(i.sources,t),r=n._makeMediaContent(i.mediaType,s.split(","));return"audio"===i.mediaType&&(e=utils.extractToHtml(o.fullScreenIntroPic,t)),n.showFullScreen(r,$(this).text(),e),!1}t=t||{};var n=this,a='<ul class="nav nav-tabs"><li class="active"><a href="#gp-intro" data-toggle="tab">'+this.lang.introHeader+'</a></li><li><a href="#gp-moreinfo" data-toggle="tab">'+this.lang.mediaHeader+'</a></li><li><a href="#gp-access" data-toggle="tab">'+this.lang.accessHeader+'</a></li></ul><div class="tab-content gp-popup"><div class="tab-pane active" id="gp-intro"></div><div class="tab-pane" id="gp-moreinfo"></div><div class="tab-pane" id="gp-access"></div></div>';a=$(a);var o=this._getFeatureData(t[this.options.attrId]),i=this._makeMediaList(o.tabMedia,t);i?a.find("#gp-moreinfo").append(i):a.find('[href="#gp-moreinfo"], #gp-moreinfo').remove();var s=this._makeAccessContent(t);s?a.find("#gp-access").append(s):a.find('[href="#gp-access"], #gp-access').remove();var r=utils.extractToHtml(o.dialogTitle||t[this.options.dialogTitle],t),l='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";if(this.dialog=utils.drawDialog(r,a,l),this.dialog.on("hidden.bs.modal",function(){$(this).empty().remove(),n.dialog=null,delete n.dialog}),this.dialog.attr("id","gp-popup"),this.dialog.find("#gp-listmoreinfo").find(".list-group-item").on("tap click",e),$("body").append(this.dialog),this.dialog.modal(),o.tabIntro){var c=utils.extractToHtml(o.tabIntro,t);"HTTP"===c.substring(0,4).toUpperCase()?this._getData(c,function(){$("#gp-intro").append(utils.extractToHtml($(this).html(),t)),smap.cmd.loading(!1)}):$("#gp-intro").append(c)}},_getData:function(t,e){var n=$("<div />");smap.cmd.loading(!0),t=this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(t):t,n.load(t,e)}}),L.control.guidePopup=function(t){return new L.Control.GuidePopup(t)},L.Control.Info=L.Control.extend({options:{addToMenu:!1,autoActivate:!1,position:"bottomright",_lang:{sv:{titleInfo:"<h4>Välkommen till smap-responsive!</h4>",bodyContent:'<h4>Vad?</h4><p>Smap-responsive är ett ramverk för att skapa kartor med "responsiv design". Det innebär att kartorna anpassar sitt innehåll efter skärmens storlek. Ramverket kan byggas ut med plugins (Leaflet-kontroller).</p><p>Koden är öppen och kan laddas ner gratis från <a target="_blank" href="https://github.com/getsmap/smap-responsive/">GitHub</a>.</p><h4>Vem?</h4><p>Ramverket har ursprungligen utvecklats av Malmö Stadsbyggnadskontor men utvecklas numera tillsammans med Kristianstad, Helsingborg och Lunds kommun.<h4>Kontakta oss!</h4><p>Har du synpunkter, frågor eller vill hjälpa till med utvecklingen? Kontakta <a href="mailto:johan.lahti@malmo.se">Johan Lahti</a>, Malmö stad.</p><p>Vill du veta mer om andra öppenkällkodsprojekt som drivs under namnet sMap – eller veta mer om bakomliggande geodata? Kontakta <a href="mailto:ulf.minor@malmo.se">Ulf Minör</a> eller <a href="mailto :Karl-Magnus.Jonsson@kristianstad.se">Karl-Magnus Jönsson.</a></p>'},en:{titleInfo:"<h4>Welcome to smap-responsive!</h4>",bodyContent:'<h4>What?</h4><p>Smap-responsive is a framework for creating maps with a "responsive design". This means the site adapts the content to the screen size. The framework can be extended with plugins (Leaflet controls).</p><p>The code is open source and can be downloaded free from <a target="_blank" href="https://github.com/getsmap/smap-responsive/">GitHub</a>.</p><h4>Who?</h4><p>The framework was originally developed by Malmö Stadsbyggnadskontor but is now developed together with the municipalities of Kristianstad, Helsingborg and Lund.<h4>Feed-back!</h4><p>Do you have suggestions, or are you interested in contributing to the development of sMap-responsive? Please contact <a href="mailto:johan.lahti@malmo.se">Johan Lahti</a>.</p><p>Do you want more info about other open source projects denoted as "sMap" – or do you want to know more about the geodata in the map(s)? Then contact <a href="mailto:ulf.minor@malmo.se">Ulf Minör</a> or <a href="mailto:Karl-Magnus.Jonsson@kristianstad.se">Karl-Magnus Jönsson.</a></p>'}}},_lang:{sv:{close:"Stäng"},en:{close:"Close"}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this.options._lang&&$.extend(!0,this._lang,this.options._lang),this._setLang(t.langCode)},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-info"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._container},onRemove:function(){},activate:function(){if(!this._$dialog){var t='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";this._$dialog=utils.drawDialog(this.lang.titleInfo,this.lang.bodyContent,t)}this._$dialog.modal("show")},_drawBtn:function(){var t=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-info",function(){return t.activate(),!1},null);else{var e=$('<button id="smap-info-btn" class="btn btn-default"><span class="fa fa-info"></span></button>');e.on("click",function(){return t.activate(),!1}),this.$container.append(e)}}}),L.control.info=function(t){return new L.Control.Info(t)},L.Control.LayerSwitcher=L.Control.extend({options:{pxDesktop:992,toggleSubLayersOnClick:!0,unfoldOnClick:!0,unfoldAll:!1,catIconClass:"fa fa-chevron-circle-right"},_lang:{sv:{baselayers:"Bakgrundslager",overlays:"Kartskikt"},en:{baselayers:"Baselayers",overlays:"Overlays"}},showLayer:function(t){return smap.core.layerInst.showLayer(t)},hideLayer:function(t){smap.core.layerInst.hideLayer(t)},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.lang)},onAdd:function(t){function e(t){var e=0;$(t).on("touchstart",function(t){e=this.scrollTop+t.originalEvent.touches[0].pageY}),$(t).on("touchmove",function(t){this.scrollTop=e-t.originalEvent.touches[0].pageY})}if(this.map=t,this._container=L.DomUtil.create("div","leaflet-control-LayerSwitcher"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._addPanel(),this._addLayers(smap.config.bl,smap.config.ol),this.options.startOpened=!1,this.options.startOpened){var n=$("#lswitch-olcont, #lswitch-blcont");1===this.options.startOpened?n.children(".lswitch-cat").click():2===this.options.startOpened?n.children(".lswitch-cat").next().find(".lswitch-cat").click():this.options.startOpened===!0&&n.find(".lswitch-cat").click()}return this._addBtn(),this._bindEvents(),$("#mapdiv").addClass("lswitch-panelslide"),L.Browser.android&&e($(".lswitch-panel")),this._container},onRemove:function(){},_addLayers:function(t,e){t=t||[],e=e||[];var n;if(t.length>1)for(var a=0,o=t.length;o>a;a++)n=t[a],n.options.isBaseLayer=!0,this._addRow(n);else $(".lswitch-panel-bl").hide();if(e.length>0)for(var a=0,o=e.length;o>a;a++)n=e[a],n.options.isBaseLayer=!1,this._addRow(n);else $(".lswitch-panel-ol").hide();t.length<=1&&0===e.length&&$(".lswitch-panel").remove()},_bindEvents:function(){var t=this;if($("#mapdiv").on("touchstart click",$.proxy(function(){return $(window).width()<this.options.pxDesktop?(this.hidePanel(),!1):void 0},this)),L.Browser.ielt9){var t=this;this.map.on("click dragstart",function(){t.hidePanel()})}var e=($.proxy(this.showPanel,this),$.proxy(this.hidePanel,this));L.Browser.touch&&$(window).on("orientationchange",function(){t.$panel.is(":visible")&&e()}),this.map.on("layeradd layerremove",function(e){if(e.layer.options&&e.layer.options.layerId&&!e.layer.feature){var n=e.layer.options.layerId,a=t._makeId(n),o=$("#"+a),i=o.hasClass("active");o.length&&("layeradd"===e.type&&i===!1?t._onRowTap({target:o}):"layerremove"===e.type&&i===!0&&t._onRowTap({target:o}))}})},_addBtn:function(){var t=$('<div id="lswitch-btn"><span class="fa fa-bars fa-2x"></span></div>');$("#mapdiv").prepend(t),t.on("click mousedown "+L.DomEvent._touchstart,$.proxy(function(){return this.showPanel(),!1},this)),t.on("dblclick",function(){return!1})},_addPanel:function(){this.$panel=$('<div class="lswitch-panel unselectable" />'),this.$panel.on("swipeleft",$.proxy(function(){this.hidePanel()},this)),this.$panel.on("touchstart",function(){$(this).css("overflow-y","auto")}),this.$list=$('<div class="panel panel-default lswitch-panel-bl"><div class="panel-heading">'+this.lang.baselayers+'</div><div id="lswitch-blcont" class="list-group"></div></div><div class="panel panel-default lswitch-panel-ol"><div class="panel-heading">'+this.lang.overlays+'</div><div id="lswitch-olcont" class="list-group"></div></div>'),this.$panel.append(this.$list),$("#maindiv").append(this.$panel)},showPanel:function(){var t=this;return this.$panel.show(),this._panelIsSliding?(utils.log("no slide"),!1):(this._panelIsSliding=!0,setTimeout(function(){$(".lswitch-panel").addClass("panel-visible")},1),setTimeout(function(){t._panelIsSliding=!1},300),void $("#mapdiv").css({"margin-left":this.$panel.outerWidth()+"px"}))},hidePanel:function(){return this._panelIsSliding?(utils.log("no slide"),!1):($("#mapdiv").css({"margin-left":"0px"}),$(".lswitch-panel").removeClass("panel-visible"),$("#maindiv").addClass("lswitch-overflow-hidden"),void setTimeout($.proxy(function(){this._panelIsSliding=!1,this.$panel.hide(),$("#maindiv").removeClass("lswitch-overflow-hidden")},this),300))},_setBaseLayer:function(t){var e,n=this.map._layers;for(var a in n)e=n[a],e&&e.options&&e.options.isBaseLayer&&e.options.layerId!==t&&this.hideLayer(e.options.layerId);this.showLayer(t)},_onRowTap:function(t){var e=$(t.target),n=e.attr("id"),a=this._unMakeId(n),o=$("#"+n).parents("#lswitch-blcont").length>0;if(o)return $("#lswitch-blcont").find("a.active").removeClass("active"),e.addClass("active"),this._setBaseLayer(a),!1;if(e.toggleClass("active"),this.options.toggleSubLayersOnClick){var i=e.hasClass("active"),s=e.parents(".lswitch-catcont");s.each(function(){if(i)$(this).prev().addClass("active");else{if($(this).find("a.list-group-item.active").length>0)return!1;$(this).prev().removeClass("active")}})}var i=e.hasClass("active");if(i){var r=e.data("t")||null;this.showLayer(r||a)}else this.map.closePopup(),this.hideLayer(a);return!1},_makeId:function(t){return"lswitchrow-"+encodeURIComponent(t).replace(/%/g,"--pr--")},_unMakeId:function(t){return decodeURIComponent(t.replace("lswitchrow-","").replace(/--pr--/g,"%"))},_toggleHeader:function(t){t.next().toggleClass("lswitch-catcont-visible"),t.toggleClass("open")},_onHeaderClick:function(t,e){e=e||{};var n=this,a=t.target;a="A"===a.tagName||"SPAN"===a.tagName?$(a).parent():$(a);var o=a.next();if(!this.options.unfoldOnClick||!this.options.unfoldAll&&e.isSubHeader||this._toggleHeader(a),!this.options.toggleSubLayersOnClick&&this.options.unfoldOnClick&&this.options.unfoldAll&&o.find("div.list-group-item").each(function(){h=$(this);var t=a.hasClass("open"),e=h.hasClass("open");t!==e&&n._toggleHeader(h)}),this.options.toggleSubLayersOnClick){var i,s,r=a.hasClass("active"),l=a.hasClass("open");this.options.unfoldOnClick&&l===r&&!e.isSubHeader?r=!r:a.toggleClass("active"),o.children(".list-group-item").each(function(){s=$(this),i=s.hasClass("active"),"A"===s[0].tagName&&r===i?n._onRowTap({target:s}):"DIV"===s[0].tagName&&r===i&&n._onHeaderClick({target:s},{isSubHeader:!0})})}return!1},_onHeaderIconClick:function(t){var e=$(t.target);return this._toggleHeader(e.parent()),!1},_addRow:function(t){function e(t,o,s){return c=t[o],r=s.find('.lswitch-cat:has(span:contains("'+c+'"))'),r.length?l=r.next():(r=$('<div class="list-group-item lswitch-cat"><i class="'+n+'"></i><span>'+c+"</span></div>").appendTo(s),l=$('<div class="lswitch-catcont"></div>'),r.after(l),r.on("tap",a.__onHeaderClick),r.find("i").on("tap",a.__onHeaderIconClick)),t.length>o+1?e(t,o+1,l):(l.append(i),!0)}this.__onRowTap=this.__onRowTap||$.proxy(this._onRowTap,this),this.__onHeaderClick=this.__onHeaderClick||$.proxy(this._onHeaderClick,this),this.__onHeaderIconClick=this.__onHeaderIconClick||$.proxy(this._onHeaderIconClick,this);var n=this.options.catIconClass,a=this,o=t.options,i=$('<a class="list-group-item">'+o.displayName+"</a>");i.attr("id",this._makeId(o.layerId)),i.on("tap",this.__onRowTap),i.data("t",t);var s;if(s=$(o.isBaseLayer?"#lswitch-blcont":"#lswitch-olcont"),o.category){var r,l,c,p=o.category;e(p,0,s)}else s.append(i);return i}}),L.control.layerSwitcher=function(t){return new L.Control.LayerSwitcher(t)},L.Control.MalmoHeader=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){this.map=t,this._container=L.DomUtil.create("div","leaflet-control-MalmoHeader"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container);var e='<!--[if IE]><meta content="IE=edge" http-equiv="X-UA-Compatible" /><![endif]-->    <!--[if lte IE 8]><script src="//assets.malmo.se/external/v4/html5shiv-printshiv.js" type="text/javascript"></script><![endif]-->    <link href="//assets.malmo.se/external/v4/masthead_standalone.css" media="all" rel="stylesheet" type="text/css"/>    <!--[if lte IE 8]><link href="//assets.malmo.se/external/v4/legacy/ie8.css" media="all" rel="stylesheet" type="text/css"/><![endif]-->    <noscript><link href="//assets.malmo.se/external/v4/icons.fallback.css" rel="stylesheet"></noscript>    <link rel="icon" type="image/x-icon" href="//assets.malmo.se/external/v4/favicon.ico" />';return $("head").prepend(e),$("body").addClass("mf-v4 no-footer"),$("body").addClass("test"),$("body").append('<script src="//assets.malmo.se/external/v4/masthead_standalone_without_jquery.js"></script>'),this._container},onRemove:function(){$("#malmo-masthead").remove()}}),L.control.malmoHeader=function(t){return new L.Control.MalmoHeader(t)},L.Control.Menu=L.Control.extend({options:{position:"topright",btnID:"my-btn"},_lang:{sv:{caption:"Exempeltext som jag ändrar"},en:{caption:"Share position link"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){this.map=t,this._container=L.DomUtil.create("div","leaflet-control-Menu"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createMenu();var e="";return this.options.btnID&&(e=this.options.btnID),this.addButton(e,"My button","fa fa-link",function(){return!1}),this._container},addButton:function(t,e,n,a,o){o=o||{};var i=t||"",s=$('<li><a id="'+i+'" href="btn btn-default"><span class="'+n+'"></span> '+e+"</a></li>");o.proxy&&(a=$.proxy(a,o.proxy)),s.on("click",a),$("#btns").append(s),o.callback&&o.callback(s)},_createMenu:function(){var t=$('<header id="smap-menu-div" class="navbar navbar-static-top bs-docs-nav" role="banner"><div class="container"><div class="navbar-header">    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">      <span class="sr-only">Toggle navigation</span>      <span class="fa fa-bars"></span>    </button><a class="navbar-brand" href="#">Stadsatlas</a>  </div>  <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">    <ul id="btns" class="nav navbar-nav navbar-right">    </ul>  </nav></div></header>');$("#maindiv").prepend(t)},onRemove:function(){}}),L.control.menu=function(t){return new L.Control.Menu(t)},L.Control.Opacity=L.Control.extend({options:{position:"bottomright",addToMenu:!1},_lang:{sv:{caption:"Ändra genomskinlighet på lager",close:"Stäng",collapsebtn:"visa/dölj lagerlista",btntitle:"Justera transparens",prefTxt:"Spara inställningar"},en:{caption:"Transparency tool",close:"Close",collapsebtn:"show/hide layers",btntitle:"Adjust transparency",prefTxt:"Save settings"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){var e=this;return e.allNamesInGui=[],t.on("layeradd layerremove",function(t){if(t.layer.options&&t.layer.options.layerId&&!t.layer.feature){var n=t.layer.options.layerId;if(-1==$.inArray(n,e.allNamesInGui))e.allNamesInGui.push(n);else if("layerremove"===t.type){var a=$.inArray(n,e.allNamesInGui);e.allNamesInGui.splice(a,1),$("#op-rowsdiv").find("#"+n).remove()}}}),e._container=L.DomUtil.create("div","leaflet-control-Opacity"),L.DomEvent.disableClickPropagation(e._container),e.$container=$(e._container),e._createBtn(),e._container},_addLayers:function(t){var e=$("<div class='op-opdiv'><button id='op-collapsebtn' type='button' class='btn' data-toggle='collapse' data-target='#op-rowsdiv'>"+this.lang.collapsebtn+"</button><div id='op-rowsdiv' class='collapse in'></div></div>"),n=e.children("#op-rowsdiv");return a=0,$.each(t,function(){var t=smap.core.layerInst._getLayer(this);if(null!=t){var e=null!=t.options.opacity?t.options.opacity:1,o=Math.round(100*e),i=$("<div class='op-rows' id='"+t.options.layerId+"' ><span class='op-mapname'>"+t.options.displayName+"</span><span class='op-values'>"+o+"</span><input class='op-sliderdiv' data-slider-tooltip='hide'data-slider-id='slider"+a+"' type='text' data-slider-min='0' data-slider-max='100' data-slider-value='"+o+"' data-slider-step='1'/>");i.children("input").slider().on("slide",function(t){var e=$(this).closest("div.op-rows"),n=e.get(0).id,a=smap.core.layerInst._getLayer(n);a.setOpacity?a.setOpacity(t.value/100):a.options.style&&a.setStyle({opacity:t.value/100,fillOpacity:t.value/100}),e.children("span.op-values").text(t.value)}).on("slideStart",function(){$("#op-modal").addClass("op-modal-slideeffect")}).on("slideStop",function(){$("#op-modal").removeClass("op-modal-slideeffect")}),a+=1,n.append(i)}}),e},_onClose:function(){this.options.savePrefBox&&0==$("#op-prefs").is(":checked")&&$.each($("div.op-rows"),function(){smap.core.layerInst._getLayer(this.id).setOpacity?smap.core.layerInst._getLayer(this.id).setOpacity(1):theLyr.options.style&&theLyr.setStyle({opacity:1,fillOpacity:1}),$(this).children("span.op-values").text(100)})},activate:function(){var t=this,e=t._addLayers(t.allNamesInGui);if(!t._$dialog){if(t.options.savePrefBox&&1==t.options.savePrefBox)var n="<div id='op-prefdiv'><label for='op-prefs'>"+t.lang.prefTxt+"</label><input id='op-prefs' type='checkbox'  name='saveprefs' checked /></div><button type='button' class='btn btn-default' data-dismiss='modal'>"+this.lang.close+"</button>";else var n='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";t._$dialog=utils.drawDialog(t.lang.caption,e,n),t._$dialog.attr("id","op-modal"),t._$dialog.on("hidden.bs.modal",function(){t._onClose(),t._$dialog.empty().remove(),t._$dialog=null})}t._$dialog.modal("show")},_createBtn:function(){var t=this;if(t.options.addToMenu)smap.cmd.addToolButton("","fa fa-adjust",function(){return t.activate(),!1},null);else{var e=$('<button id="smap-opacity-btn" title="'+t.lang.btntitle+'" class="btn btn-default"><span class="fa fa-adjust"></span></button>');e.on("click",function(){return t.activate(),!1}),t.$container.append(e)}},onRemove:function(){}}),L.control.opacity=function(t){return new L.Control.Opacity(t)},L.Control.OpenSearch=L.Control.extend({options:{whitespace:"%2B",wsOrgProj:"EPSG:3006",pxDesktop:992,addToMenu:!1},_lang:{sv:{search:"Sök",addressNotFound:"Den sökta adressen hittades inte",remove:"Ta bort"},en:{search:"Search",addressNotFound:"The searched address was not found",remove:"Remove"}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){var e=this;return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-opensearch"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),this._makeSearchField(),this.__onApplyParams=this.__onApplyParams||$.proxy(this._onApplyParams,this),smap.event.on("smap.core.applyparams",this.__onApplyParams),this.__onCreateParams=this.__onCreateParams||$.proxy(this._onCreateParams,this),smap.event.on("smap.core.createparams",this.__onCreateParams),this.map.on("click",this._blurSearch),e._container},_blurSearch:function(){$("#smap-opensearch-div input").blur()},onRemove:function(){smap.event.off("smap.core.applyparams",this.__onApplyParams),smap.event.off("smap.core.createparams",this.__onCreateParams),this.map.off("click",this._blurSearch)},_onApplyParams:function(t,e){if(e.POI){var n=e.POI instanceof Array?e.POI[0]:e.POI;n=n.replace(/--c--/g,",");var a=e.POI instanceof Array&&e.POI.length>1?e.POI[1]:!1;this._geoLocate(decodeURIComponent(n),{setView:!1,showPopup:a})}},_onCreateParams:function(t,e){if(this.marker&&this.marker.options.q){var n=this.marker.getPopup()._isOpen?!0:!1;e.POI=[encodeURIComponent(this.marker.options.q.replace(/,/g,"--c--"))],n&&e.POI.push(1)}},_rmAdressMarker:function(t){null!=t&&(this.map.removeLayer(t),this.addressMarker=null)},_makeSearchField:function(){function t(){var t=$(window).width();if(!(t>=a.options.pxDesktop)&&L.Browser.touch){var e=$("#smap-opensearch-bg");e.length||(e=$('<div id="smap-opensearch-bg" />'),o.addClass("opensearch-active"),$("#mapdiv").append(e),setTimeout(function(){e.addClass("opensearch-bg-visible")},1))}}function e(){var t=$(window).width();t>=a.options.pxDesktop||!L.Browser.touch||(o.removeClass("opensearch-active"),$("#smap-opensearch-bg").removeClass("opensearch-bg-visible"),setTimeout(function(){$("#smap-opensearch-bg").remove()},300))}function n(t){t.stopPropagation()}var a=this,o=$('<div id="smap-opensearch-div" class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span><input autocorrect="off" autocomplete="off" data-provide="typeahead" type="text" class="form-control" placeholder="'+this.lang.search+'"></input></div>'),i=o.find("input");L.Browser.msTouch&&i.attr("pattern","[0-9]"),i.on("keypress",t).on("dblclick",n).on("mousedown",n).on("focus",function(){$(this).parent().addClass("smap-opensearch-div-focused")}).on("blur",function(){$(this).parent().removeClass("smap-opensearch-div-focused")}).on("touchstart",function(){$(this).focus()}),o.on("click touchstart",function(t){$(this).find("input").focus(),t.stopImmediatePropagation()}),i.on("blur",e),$("#mapdiv").append(o),smap.event.on("smap.core.pluginsadded",function(){var t=$("#smap-menu-div nav");t.length&&o.addClass("smap-opensearch-div-in-toolbar")});var s=this.options.whitespace,r=this.options._geoLocate||this._geoLocate,l={items:5,minLength:2,highlight:!0,hint:!0,updater:function(t){return smap.cmd.loading(!0),r.call(a,t),e(),t}};this.options.wsAcUrl?l.source=function(t,e){var n=encodeURIComponent(a.options.wsAcUrl+"?q="+t);s&&(n=n.replace(/%20/g,s)),a.proxyInst&&a.proxyInst.abort(),a.proxyInst=$.ajax({type:"GET",url:smap.config.ws.proxy+n,dataType:"text",success:function(t){var n=t.split("\n");e(n)},error:function(){}})}:this.options.wsAcLocal&&this.options.wsAcLocal instanceof Array&&(l.source=this.options.wsAcLocal),i.typeahead(l)},_geoLocate:function(t,e){e=e||{};var n={setView:!0,showPopup:!0};e=$.extend({},n,e),this.options.qPattern&&(t=utils.extractToHtml(this.options.qPattern,{q:t}));var a=encodeURIComponent(this.options.wsLocateUrl+"?q="+t),o=this.options.whitespace;o&&(a=a.replace(/%20/g,o));var i={success:function(n){function a(){$("#smap-opensearch-popupbtn").off("click").on("click",function(){return o.map.removeLayer(o.marker),o.marker=null,!1})}var o=this;if(this.marker&&(this.map.removeLayer(this.marker),this.marker=null),!n.features.length)return void smap.cmd.notify(this.lang.addressNotFound,"error");var i=n.features[0].geometry.coordinates,s=L.latLng(i[1],i[0]),r="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==r){var l=window.proj4(this.options.wsOrgProj,r,[s.lng,s.lat]);s=L.latLng(l[1],l[0])}this.map.off("popupopen",a),this.map.on("popupopen",a),this.marker=L.marker(s).addTo(this.map),this.marker.options.q=t,this.marker.bindPopup('<p class="lead">'+t+'</p><div><button id="smap-opensearch-popupbtn" class="btn btn-default">'+this.lang.remove+"</button></div>"),e.setView&&this.map.setView(s,15,{animate:!1}),e.showPopup&&this.marker.openPopup(),$("#smap-opensearch-div input").val(null),$("#smap-opensearch-div input").blur(),setTimeout(function(){$("#smap-opensearch-div input").blur()},100)},complete:function(){smap.cmd.loading(!1)
}};$.ajax({url:smap.config.ws.proxy+a,type:"GET",dataType:"json",context:this,success:this.options.onLocateSuccess||i.success,complete:i.complete})},CLASS_NAME:"L.Control.OpenSearch"}),L.control.openSearch=function(t){return new L.Control.OpenSearch(t)},L.Control.Print=L.Control.extend({options:{position:"bottomright",addToMenu:!1,printUrl:"printMock.py"},_lang:{sv:{caption:"Skriv ut",close:"Stäng"},en:{caption:"Print",close:"Close"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-Print"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._container},activate:function(){var params=smap.cmd.createParamsAsObject();$.post(this.options.printUrl,{params:params},function(data){var win=window.open("about:blank");with(win.document)open(),write(data),close()})},_createBtn:function(){var t=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-print",function(){return t.activate(),!1},null);else{var e=$('<button id="smap-print-btn" class="btn btn-default"><span class="fa fa-print"></span></button>');e.on("click",function(){return t.activate(),!1}),this.$container.append(e)}},onRemove:function(){}}),L.control.Print=function(t){return new L.Control.Print(t)},L.Control.RedirectClick=L.Control.extend({options:{position:"bottomright",btnID:"redirect-click-btn",displayName:"Snedbild",toolbarIndex:4,url:"http://kartor.helsingborg.se/urbex/sned_2011.html?p=true&xy=${x};${y}",overrideName:"snedbild",btnLabel:"Snedbild",btnHover:"Verktyg för att se snedbilder",buttonId:"redirect-snedbild",buttonCss:"ui-icon-arrowstop-1-s",mouseMoveText:"Klicka i kartan för att redirect till snedbild",mouseMoveSubtext:"",addToMenu:!1},_lang:{sv:{modalTitle:"Lager i kartan",btntitle:"Klicka i kartan för att redirect till snedbild"},en:{modalTitle:"Layers in the map",btntitle:"Click on the map to redirect to snedbild"}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode),this._setURL(this.options.url)},_setURL:function(t){var e=this;e.options.url=t?t||e.options.url:null},onAdd:function(t){var e=this;return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-RedirectClick"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),e._createButton(),this._container},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._tooltip=new L.Tooltip({map:this._map,trackMouse:!0,target:$("body"),showDelay:1,hideDelay:1,fadeAnimation:!1,mouseOffset:L.point(0,10)}),this._tooltip.setHtml(""+this.options.mouseMoveText),this._map.on("mousemove mouseup",this._onMouseMove,this))},removeHooks:function(){this._map&&this._tooltip&&(this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this),this._map.off("click"),$("#mapdiv").find(".leaflet-tooltip-container").children().remove())},removeBtnClass:function(){$("#"+this.options.btnID).removeClass("redirect-click-btn-on")},addBtnClass:function(){$("#"+this.options.btnID).addClass("redirect-click-btn-on")},_projectEPSG:function(t){var e=new Proj4js.Proj("EPSG:4326"),n=new Proj4js.Proj("EPSG:3008"),a=(L.Proj,new Proj4js.Point(t.latlng.lng,t.latlng.lat));return Proj4js.transform(e,n,a),t.latlng.lat=a.x,t.latlng.lng=a.y,t},_onMouseMove:function(t){if(t.layerPoint)t.layerPoint.x=t.originalEvent.clientX,t.layerPoint.y=t.originalEvent.clientY,this._tooltip.setPosition(t.layerPoint),this._tooltip.show(t.layerPoint,""+this.options.mouseMoveText);else{var e={x:t.originalEvent.clientX,y:t.originalEvent.clientY};this._tooltip.setPosition(e),this._tooltip.show(e,""+this.options.mouseMoveText)}},_addEvents:function(){return this.addHooks(),!1},_createButton:function(){var t=this;if(t.options.addToMenu)smap.cmd.addToolButton("","fa fa-external-link",function(){var e=L.control.menu({});return e.addButton(this.options.btnID,this.options.btnLabel,this.options.buttonCss,function(){return!1}),$("#"+this.options.btnID).on("click",function(){t._tooltip?(t.removeHooks(),t.removeBtnClass()):(t.addHooks(),t.addBtnClass(),t._map.on("click",function(){t.removeBtnClass(),t.onDone(evt),t.removeHooks()}))}),t.$container=$(this._container),!1},null);else{var e=$('<button id="'+t.options.btnID+'" title="'+t.options.btnLabel+'" class="btn btn-default"><span class="fa fa-external-link"></span></button>');e.on("click",function(){return t._tooltip?(t.removeHooks(),t.removeBtnClass()):(t.addHooks(),t.addBtnClass(),t._map.on("click",function(e){t.removeBtnClass(),t.onDone(e),t.removeHooks()})),!1}),t.$container.append(e)}},onRemove:function(){this.$container.empty()},onDone:function(t){var e=this.options.url;if(e){var n=new proj4.Proj("EPSG:4326"),a=new proj4.Proj("EPSG:3008"),o={x:t.latlng.lng,y:t.latlng.lat};proj4.transform(n,a,o),e=e.replace(/\${x}/g,o.x).replace(/\${y}/g,o.y)}window.open(e,this.options.btnLabel)}}),L.control.redirectclick=function(t){return new L.Control.RedirectClick(t)},L.Control.Search=L.Control.extend({options:{whitespace:"%2B",wsOrgProj:"EPSG:3006",pxDesktop:992,addToMenu:!1},_lang:{sv:{search:"Sök",addressNotFound:"Den sökta adressen hittades inte",remove:"Ta bort"},en:{search:"Search",addressNotFound:"The searched address was not found",remove:"Remove"}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){var e=this;return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-search"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),this._makeSearchField(),this.__onApplyParams=this.__onApplyParams||$.proxy(this._onApplyParams,this),smap.event.on("smap.core.applyparams",this.__onApplyParams),this.__onCreateParams=this.__onCreateParams||$.proxy(this._onCreateParams,this),smap.event.on("smap.core.createparams",this.__onCreateParams),this.map.on("click",this._blurSearch),e._container},_blurSearch:function(){$("#smap-search-div input").blur()},onRemove:function(){smap.event.off("smap.core.applyparams",this.__onApplyParams),smap.event.off("smap.core.createparams",this.__onCreateParams),this.map.off("click",this._blurSearch)},_onApplyParams:function(t,e){if(e.POI){var n=e.POI instanceof Array?e.POI[0]:e.POI;n=n.replace(/--c--/g,",");var a=e.POI instanceof Array&&e.POI.length>1?e.POI[1]:!1;this._geoLocate(decodeURIComponent(n),{setView:!1,showPopup:a})}},_onCreateParams:function(t,e){if(this.marker&&this.marker.options.q){var n=this.marker.getPopup()._isOpen?!0:!1;e.POI=[encodeURIComponent(this.marker.options.q.replace(/,/g,"--c--"))],n&&e.POI.push(1)}},_rmAdressMarker:function(t){null!=t&&(this.map.removeLayer(t),this.addressMarker=null)},_makeSearchField:function(){function t(){var t=$(window).width();if(!(t>=a.options.pxDesktop)&&L.Browser.touch){var e=$("#smap-search-bg");e.length||(e=$('<div id="smap-search-bg" />'),o.addClass("search-active"),$("#mapdiv").append(e),setTimeout(function(){e.addClass("search-bg-visible")},1))}}function e(){var t=$(window).width();t>=a.options.pxDesktop||!L.Browser.touch||(o.removeClass("search-active"),$("#smap-search-bg").removeClass("search-bg-visible"),setTimeout(function(){$("#smap-search-bg").remove()},300))}function n(t){t.stopPropagation()}var a=this,o=$('<div id="smap-search-div" class="input-group input-group-lg"><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span><input autocorrect="off" autocomplete="off" data-provide="typeahead" type="text" class="form-control" placeholder="'+this.lang.search+'"></input></div>'),i=o.find("input");L.Browser.msTouch&&i.attr("pattern","[0-9]"),i.on("keypress",t).on("dblclick",n).on("mousedown",n).on("focus",function(){$(this).parent().addClass("smap-search-div-focused")}).on("blur",function(){$(this).parent().removeClass("smap-search-div-focused")}).on("touchstart",function(){$(this).focus()}),o.on("click touchstart",function(t){$(this).find("input").focus(),t.stopImmediatePropagation()}),i.on("blur",e),$("#mapdiv").append(o),smap.event.on("smap.core.pluginsadded",function(){var t=$("#smap-menu-div nav");t.length&&o.addClass("smap-search-div-in-toolbar")});var s=this.options.whitespace,r=this.options._geoLocate||this._geoLocate,l={items:5,minLength:2,highlight:!0,hint:!0,updater:function(t){return smap.cmd.loading(!0),r.call(a,t),e(),t}};this.options.wsAcUrl?l.source=function(t,e){var n=encodeURIComponent(a.options.wsAcUrl+"?q="+t);s&&(n=n.replace(/%20/g,s)),a.proxyInst&&a.proxyInst.abort(),a.proxyInst=$.ajax({type:"GET",url:smap.config.ws.proxy+n,dataType:"text",success:function(t){var n=t.split("\n");e(n)},error:function(){}})}:this.options.wsAcLocal&&this.options.wsAcLocal instanceof Array&&(l.source=this.options.wsAcLocal),i.typeahead(l)},_geoLocate:function(t,e){e=e||{};var n={setView:!0,showPopup:!0};e=$.extend({},n,e),this.options.qPattern&&(t=utils.extractToHtml(this.options.qPattern,{q:t}));var a=encodeURIComponent(this.options.wsLocateUrl+"?q="+t),o=this.options.whitespace;o&&(a=a.replace(/%20/g,o));var i={success:function(n){function a(){$("#smap-search-popupbtn").off("click").on("click",function(){return o.map.removeLayer(o.marker),o.marker=null,!1})}var o=this;if(this.marker&&(this.map.removeLayer(this.marker),this.marker=null),!n.features.length)return void smap.cmd.notify(this.lang.addressNotFound,"error");var i=n.features[0].geometry.coordinates,s=L.latLng(i[1],i[0]),r="EPSG:4326";if(this.options.wsOrgProj&&this.options.wsOrgProj!==r){var l=window.proj4(this.options.wsOrgProj,r,[s.lng,s.lat]);s=L.latLng(l[1],l[0])}this.map.off("popupopen",a),this.map.on("popupopen",a),this.marker=L.marker(s).addTo(this.map),this.marker.options.q=t,this.marker.bindPopup('<p class="lead">'+t+'</p><div><button id="smap-search-popupbtn" class="btn btn-default">'+this.lang.remove+"</button></div>"),e.setView&&this.map.setView(s,15,{animate:!1}),e.showPopup&&this.marker.openPopup(),$("#smap-search-div input").val(null),$("#smap-search-div input").blur(),setTimeout(function(){$("#smap-search-div input").blur()},100)},complete:function(){smap.cmd.loading(!1)}};$.ajax({url:smap.config.ws.proxy+a,type:"GET",dataType:"json",context:this,success:this.options.onLocateSuccess||i.success,complete:i.complete})},CLASS_NAME:"L.Control.Search"}),L.control.search=function(t){return new L.Control.Search(t)},L.Control.SelectVector=L.Control.extend({options:{position:"bottomright",selectStyle:{weight:5,color:"#00FFFF",fillColor:"#00FFFF",opacity:1,fillOpacity:.5}},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_selectedFeatures:[],_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode);var e=this;this._onFeatureClick=function(t){e.onFeatureClick(t)}},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-selectvector"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.css("display","none"),this._bindEvents(),this._container},onRemove:function(){this.map.off("layeradd",this._onLayerAdded),this.map.off("click",this._onMapClick)},_bindEvents:function(){this._onLayerAdded=$.proxy(this.onLayerAdded,this),this._onLayerRemoved=$.proxy(this.onLayerRemoved,this),this._onMapClick=$.proxy(this.onMapClick,this),this.map.on("layeradd",this._onLayerAdded),this.map.on("layerremove",this._onLayerRemoved),this.map.on("click",this._onMapClick)},onMapClick:function(){this._selectedFeatures=[]},_vectorLayers:[],onLayerAdded:function(t){var e=this,n=t.layer,a=n.hasOwnProperty("_layers")&&n.resetStyle;a&&(n.on("load",function(){this.eachLayer(function(t){t.options=t.options||{},t.options.layerId=n.options.layerId,t.off("click",e._onFeatureClick).on("click",e._onFeatureClick)})}),this._vectorLayers.push(n))},onLayerRemoved:function(t){if(t.layer.options&&t.layer.options.layerId){var e=t.layer.options.layerId;if(e&&t.layer._layers){var n=$.inArray(t.layer,this._vectorLayers);n>-1&&this._vectorLayers.splice(n,1)}}},_layerFromFeature:function(t,e){var n=e._layers;for(var a in n){var o=n[a];if(o.feature.id===t.id)return o}return null},unselect:function(t){var e=t.layerId,n=smap.cmd.getLayer(e),a=$.inArray(t,this._selectedFeatures);this._selectedFeatures.splice(a,1);var o=utils.getLayerFromFeature(t,n)||n;n.resetStyle.call(n,o),this._map.fire("unselected",{feature:t})},onFeatureClick:function(t){var e=t.target.feature,n=t.originalEvent?t.originalEvent.shiftKey||!1:!1,a=t.target,o=a.options.layerId||t.layer.options.layerId,i=smap.core.layerInst._getLayer(o);if(i&&n===!1){this._selectedFeatures=[];var s=i.resetStyle;i.eachLayer(function(t){s.call(i,t)});for(var r=this._vectorLayers,l=0,c=r.length;c>l;l++)d=r[l],d!==i&&d.resetStyle(d)}var p=$.inArray(e,this._selectedFeatures);if(n===!0&&p>-1){this._selectedFeatures.splice(p,1),this._map.fire("unselected",{feature:e});var d=this._layerFromFeature(e,i);i.resetStyle.call(i,d)}else{e.layerId=o,e.uniqueKey=i.options.uniqueKey,this._selectedFeatures.push(e);var u=this._layerFromFeature(e,i);u&&u.setStyle&&u.setStyle(i.options.selectStyle||this.options.selectStyle),this._map.fire("selected",{feature:e,selectedFeatures:this._selectedFeatures,layer:i,latLng:t.latlng,shiftKeyWasPressed:t.originalEvent?t.originalEvent.shiftKey||!1:!1}),utils.log("selected a feature")}},A:1}),L.control.selectVector=function(t){return new L.Control.SelectVector(t)},L.Control.SelectWMS=L.Control.extend({options:{wmsVersion:"1.3",outputFormat:"GML2",srs:"EPSG:4326",info_format:"text/plain",featureCount:1,buffer:5,onSuccess:function(t,e){var n=e.context,a=e.params.layers;a.split(",").length>1&&(a=e.params.layers.split(",")[0]);var o=smap.cmd.getLayerConfigBy("layers",a);if(!o||!o.options||!o.options.layerId)return!1;var i=o.options.layerId;if(t&&$.isEmptyObject(t)===!1){n._selectedFeatures.push([i,e.latLng.lng,e.latLng.lat]);var s=e.latLng,r={geometry:{coordinates:[s.lng,s.lat]},latLng:s,properties:t,layerId:i,uniqueKey:o.options.uniqueKey};e.map.fire("selected",{layer:n,feature:r,latLng:s,selectedFeatures:[r]})}},onError:function(){}},_layers:[],_selectedFeatures:[],initialize:function(t){L.setOptions(this,t)},onAdd:function(t){return this.map=t,this._bindEvents(),this._container=L.DomUtil.create("div","leaflet-control-selectwms"),$(this._container).css("display","none"),L.DomEvent.disableClickPropagation(this._container),this._container},onRemove:function(){this._unbindEvents()},_applyParam:function(t){var e,n,a,o,i,s=JSON.parse(decodeURIComponent(t));for(n in s)a=s[n],a.xy&&(e=smap.core.layerInst.showLayer(n),o=a.xy[0],i=L.latLng(o[1],o[0]),this.onMapClick({latlng:i,_layers:[e]}))},_bindEvents:function(){var t=this;smap.event.on("smap.core.applyparams",function(e,n){n.SEL&&t._applyParam(decodeURIComponent(n.SEL))}),this.map.on("layeradd",this.onLayerAdd,this).on("layerremove",this.onLayerRemove,this).on("click",this.onMapClick,this)},_unbindEvents:function(){this.map.off("layeradd",this.onLayerAdd,this).off("layerremove",this.onLayerRemove,this).off("click",this.onMapClick,this)},onLayerAdd:function(t){var e=t.layer;this._layerShouldBeAdded(e)===!0&&this._layers.push(e)},onLayerRemove:function(t){var e=t.layer,n=this._hasLayer(e);n!==!1&&this._layers.splice(n,1)},onMapClick:function(t){this._selectedFeatures=[];var e=t.latlng;this.xhr&&this.xhr.abort();var n=t._layers||this._layers;if(n.length){var a,o,i,s={};$.each(n,function(t,e){o=e._url,i=o.toUpperCase(),s[i]||(s[i]={layerNames:[],url:o,wmsVersion:e._wmsVersion,layerId:e.options.layerId}),s[i].layerNames.push(e.options.layers)});var r;for(var i in s)a=s[i],r=this._makeParams({layers:a.layerNames.join(","),version:a._wmsVersion||this.options.wmsVersion,info_format:this.options.info_format,latLng:e}),this.request(a.url,r,{onSuccess:this.options.onSuccess,onError:function(){},layerId:a.layerId,latLng:e})}},_layerShouldBeAdded:function(t){var e=t._wmsVersion?!0:!1;return t.options&&t.options.selectable&&t.options.selectable===!0&&this._hasLayer(t)===!1&&e===!0?!0:!1},_hasLayer:function(t){for(var e=this._layers,n=0,a=e.length;a>n;n++)if(t===e[n])return n;return!1},_makeParams:function(t){t=t||{};var e=this.map.latLngToContainerPoint(t.latLng),n=this.map.getBounds(),a={service:"WMS",request:"GetFeatureInfo",version:"1.1.1",bbox:n.toBBoxString(),layers:t.layers,query_layers:t.layers,info_format:t.info_format,format:"image/png",feature_count:this.options.featureCount,x:utils.round(e.x),y:utils.round(e.y),buffer:this.options.buffer,width:utils.round(this.map.getSize().x),height:utils.round(this.map.getSize().y),srs:this.options.srs||"EPSG:4326",exceptions:"application%2Fvnd.ogc.se_xml"};return a},_parseText:function(t){for(var e,n,a,o,i,s={},r={},l=t.split("\n"),c=0,p=l.length;p>c;c++)if(e=l[c],-1!==e.search("=")){if(n=e.split("="),n.length>2){var d=n.slice(1);a=d.join("=")}else a=n[1];a=$.trim(a);var u=/^[0-9.]+$/.test(a),h=a.split("."),m=h.length<=2&&h[0].length>0&&(1===h.length||2===h.length&&h[1].length>0);if(u===!0&&m){try{switch(h.length){case 1:o=parseInt(a);break;case 2:o=parseFloat(a)}}catch(f){}o&&isNaN(o)===!1&&(a=o)}r[$.trim(n[0])]=a}else{var g=e.search(/'/);if(g>-1){e=e.substring(g+1),g=e.search(/'/),i&&s[i]&&$.isEmptyObject(r)===!1&&(s[i].push($.extend({},r)),r={}),i=e.substring(0,g),s[i]||(s[i]=[]);continue}i&&s[i]&&$.isEmptyObject(r)===!1&&(s[i].push($.extend({},r)),r={})}return i&&s[i]&&$.isEmptyObject(r)===!1&&s[i].push($.extend({},r)),s},request:function(t,e,n){e=e||{},n=n||{};var a=this.proxy||L.Control.SelectWMS.proxy;this.xhr=$.ajax({url:a?a+encodeURIComponent(t):t,data:e,type:"POST",dataType:"text",context:this,success:function(t){var a=this._parseText(t);n.onSuccess(a,{latLng:n.latLng,map:this.map,context:this,params:e})},error:function(){n.onError()},complete:function(){}})},CLASS_NAME:"L.Control.SelectWMS"}),L.control.selectWMS=function(t){return new L.Control.SelectWMS(t)},L.Control.ShareLink=L.Control.extend({options:{position:"bottomright",addToMenu:!1},_lang:{sv:{caption:"Länk till kartan",close:"Stäng"},en:{caption:"Share link",close:"Close"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-ShareLink"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._createBtn(),this._container},activate:function(){var t=this,e=smap.cmd.createParams(!0),n=$('<div class="form-group"><input type="text" class="form-control" placeholder="'+this.lang.caption+'"></div>'),a=n.find("input");a.val(e);var o=function(t){t.setSelectionRange?t.setSelectionRange(0,9999):$(t).select()};if(!this._$dialog){var i='<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.close+"</button>";this._$dialog=utils.drawDialog(this.lang.caption,n,i),this._$dialog.attr("id","slink-modal"),a.on("tap click",function(){o(this)}),this._$dialog.on("shown.bs.modal",function(){o(a[0])}),this._$dialog.on("hide.bs.modal",function(){$(this).find("input[type=text]").blur()}),this._$dialog.on("hidden.bs.modal",function(){t._$dialog.empty().remove(),t._$dialog=null})}this._$dialog.modal("show")},_createBtn:function(){var t=this;if(this.options.addToMenu)smap.cmd.addToolButton("","fa fa-link",function(){return t.activate(),!1},null);else{var e=$('<button id="smap-sharelink-btn" class="btn btn-default"><span class="fa fa-link"></span></button>');e.on("click",function(){return t.activate(),!1}),this.$container.append(e)}},onRemove:function(){}}),L.control.sharePos=function(t){return new L.Control.SharePos(t)},L.Control.SharePosition=L.Control.extend({options:{position:"bottomright",autoActivate:!1,wfsSource:"http://xyz.malmo.se:8081/geoserver/wfs",wfsFeatureType:"sandbox:sharedpositions",wfsUri:"http://www.malmo.se/sandbox/",useProxy:!0,maxAge:15,_refreshIntervalMs:1e4,_storeIntervalMs:1e4},_lang:{sv:{dTitle:"Dela position",dShare:"Dela!",yourName:"Ditt namn",stopSharing:"Sluta dela",btnCancel:"Avbryt"},en:{dTitle:"Share position",dShare:"Share!",yourName:"Your name",stopSharing:"Stop sharing",btnCancel:"Cancel"}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},deactivate:function(){this._stopRefresh(),$("#smap-share-btn").removeClass("btn-danger"),this.dialog.find("input").val(null),$("#smap-share-btn").hide(),this.map.removeLayer(this.layer)},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-shareposition"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawGui(),this._bindEvents(),this._container},onRemove:function(t){t.stopLocate()},_drawGui:function(){var t=$('<button id="smap-share-btn" class="btn btn-default" type="button"><span class="fa fa-user"></span></button>');t.hide(),this.$container.append(t);var e=this;smap.event.on("smap.core.pluginsadded",function(){$(".leaflet-control-Geolocate").before(e.$container)});var n='<div class="form-group"><label>'+this.lang.yourName+'</label><input type="text" class="form-control" placeholder="'+this.lang.yourName+'"></input></div>',a=$('<button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.btnCancel+'</button><button type="button" class="btn btn-primary">'+this.lang.dShare+"</button>");this.dialog=utils.drawDialog(this.lang.dTitle,n,a)},_makeFilter:function(){var t=this.options.maxAge,e=new Date,n=e.getTime(),a=n-60*t*1e3,o=new Date(a),i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN,property:"datetime_changed",value:o}),s=new OpenLayers.Format.Filter({version:"1.1.0"}),r=new OpenLayers.Format.XML,l=r.write(s.write(i));return l},_addLayer:function(){var t=this;this.layer=smap.core.layerInst._createLayer({init:"L.GeoJSON.WFS",url:this.options.wfsSource,options:{noBindZoom:!0,noBindDrag:!0,layerId:"_shareposition",displayName:"Shared locations",featureType:this.options.wfsFeatureType,attribution:"Malmö stads WFS",inputCrs:"EPSG:4326",selectable:!0,popup:'<span><strong>${text_username}</strong>&nbsp;&nbsp;(<span style="white-space:nowrap;">${function(p) {var d = new Date(p.datetime_changed);var dNow = new Date(); var dDiff = new Date( Math.abs(dNow.getTime() - d.getTime()) ); return dDiff.getMinutes(); }}</span> min ago)</span>',hoverColor:"#FF0",zIndex:350,reverseAxis:!1,reverseAxisBbox:!0,uniqueKey:"id",params:{typeName:"sandbox:sharedpositions",version:"1.1.0",maxFeatures:1e4,format:"text/geojson",outputFormat:"json"}}}),this.layer.options.params.filter=this._makeFilter(),this.layer.off("load"),this.layer.on("load",function(){t.layer.eachLayer(function(e){var n=L.userMarker(e.getLatLng(),{pulsing:!0,smallIcon:!0});if(t.layer.removeLayer(e),e.feature){var a=parseInt(e.feature.id.split(".")[1]),o=t.uid||localStorage.share_uid||null;o=parseInt(o),(!o||o&&o!==a)&&t.layer.addLayer(n);var i=utils.extractToHtml(t.layer.options.popup,e.feature.properties);n.bindLabel(i,{noHide:!0,direction:"right"}).showLabel()}}),smap.cmd.loading(!1)}),this.map.addLayer(this.layer);var t=this},_bindEvents:function(){var t=this;smap.event.on("smap.core.pluginsadded",function(){$("#smap-glocate-btn").on("click",function(){return $(this).hasClass("btn-primary")?($("#smap-share-btn").show(),t._addLayer(),t._startRefresh()):(t._stopShare(),t.deactivate()),!1}),$("#smap-share-btn").on("click",function(){var e=$(this).hasClass("btn-danger");e?($(this).removeClass("btn-danger"),t._stopShare()):t.dialog.modal("show")})}),this.dialog.find("input").on("click",function(){$(this).focus()}),this.dialog.find(".modal-footer .btn-primary").on("click",function(){$("#smap-share-btn").addClass("btn-danger"),t.dialog.modal("hide");var e=$.trim(t.dialog.find("input[type='text']").val());t._startShare(e)})},_onLocationFound:function(t){this._location=t},_onLocationError:function(){smap.cmd.loading(!1)},_setLocateSettings:function(){var t={watch:!0,timeout:3e4,enableHighAccuracy:!0,frequency:3e3};$.extend(this.map._locateOptions,t)},_startShare:function(t){return this._storeInterval?!1:(utils.log("START sharing"),this.uName=t,this.__onLocationFound=this.__onLocationFound||$.proxy(this._onLocationFound,this),this.__onLocationError=this.__onLocationError||$.proxy(this._onLocationError,this),this.map.on("locationfound",this.__onLocationFound),this.map.on("locationerror",this.__onLocationFound),this.uid=localStorage.share_uid||null,this.__store=this.__store||$.proxy(this._store,this),this._storeInterval=setInterval(this.__store,this.options._storeIntervalMs),this._setLocateSettings(),void this.map.fire("drag"))},_startRefresh:function(){return this._refreshInterval?!1:(utils.log("start refreshing"),this.__refresh=this.__refresh||$.proxy(this._refresh,this),void(this._refreshInterval=setInterval(this.__refresh,this.options._refreshIntervalMs)))},_stopRefresh:function(){utils.log("stop refreshing"),clearInterval(this._refreshInterval),this._refreshInterval=null},_stopShare:function(){smap.cmd.loading(!1),utils.log("stop sharing"),this._stopRefresh(),clearInterval(this._storeInterval),this._storeInterval=null,this.map.off("locationfound",this.__onLocationFound,this),this.map.off("locationerror",this.__onLocationError,this),this._location=null,this.uid=null,this.uName=null},uid:null,_store:function(){return this._working||!this._location?!1:(this._working=!0,void $.ajax({url:this.options.useProxy?smap.config.ws.proxy+encodeURIComponent(this.options.wfsSource):this.options.wfsSource,type:"POST",context:this,data:this._getXml(this._location.latlng,this._location.accuracy,this.uName,this.uid),contentType:"text/xml",dataType:"text",error:function(t,e){utils.log("SharePosition: Error storing coordinates because of: "+e)},success:function(t){var e=$.xml2json(t),n=e?e.TransactionResponse||e["wfs:TransactionResponse"]:null;if(n){var a=n?n.TransactionSummary||n["wfs:TransactionSummary"]:null;if(a){var o=parseInt(a.totalInserted||a["wfs:totalInserted"]),i=parseInt(a.totalUpdated||a["wfs:totalUpdated"]);if(!this.uid&&o>0){var s=n.InsertResults||n["wfs:InsertResults"],r=s.Feature||s["wfs:Feature"],l=r.FeatureId||r["ogc:FeatureId"],c=l.fid||l.$.fid;this.uid=parseInt(c.split(".")[1]),localStorage.share_uid=this.uid}else 0===o&&0===i&&(this.uid=null,delete localStorage.share_uid)}}},complete:function(){this._working=!1}}))},_refresh:function(){this.layer.options.params.filter=this._makeFilter(),this.layer._refresh(!0)},_getXml:function(t,e,n,a){var o="",i=this.options.wfsFeatureType.split(":")[1];return o=a?'<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="'+this.options.wfsUri+'"\n  xmlns:wfs="http://www.opengis.net/wfs"\n  xmlns:ogc="http://www.opengis.net/ogc"\n  xmlns:gml="http://www.opengis.net/gml"\n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="http://www.opengis.net/wfs\n                      http://schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd">\n  <wfs:Update typeName="grp:'+i+'">\n	 <wfs:Property><wfs:Name>text_username</wfs:Name><wfs:Value>'+n+"</wfs:Value></wfs:Property>	 <wfs:Property><wfs:Name>int_accuracy</wfs:Name><wfs:Value>"+e+'</wfs:Value></wfs:Property>    <wfs:Property>\n      <wfs:Name>the_geom</wfs:Name>\n      <wfs:Value>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+t.lat+","+t.lng+"</gml:coordinates>\n        </gml:Point>\n      </wfs:Value>\n    </wfs:Property>\n    <ogc:Filter>\n      <PropertyIsEqualTo>\n        <PropertyName>id</PropertyName>\n        <Literal>"+a+"</Literal>\n      </PropertyIsEqualTo>\n    </ogc:Filter>\n  </wfs:Update>\n</wfs:Transaction>":'<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="'+this.options.wfsUri+'"\n  xmlns:wfs="http://www.opengis.net/wfs"\n  xmlns:gml="http://www.opengis.net/gml"\n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="http://www.opengis.net/wfs\n                      http://schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd\n                      '+this.options.wfsSource+"/DescribeFeatureType?typename="+this.options.wfsFeatureType+'">\n  <wfs:Insert>\n    <grp:'+i+'>\n      <grp:the_geom>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+t.lat+","+t.lng+"</gml:coordinates>\n        </gml:Point>\n      </grp:the_geom>\n      <grp:int_accuracy>"+e+"</grp:int_accuracy>\n      <grp:text_username>"+n+"</grp:text_username>\n    </grp:"+i+">\n  </wfs:Insert>\n  </wfs:Transaction>"}}),L.control.sharePosition=function(t){return new L.Control.SharePosition(t)},L.Control.ShareTweet=L.Control.extend({options:{position:"topright",wfsSource:"http://localhost:8080/geoserver/wfs",wfsFeatureType:"local:tweets"},_lang:{sv:{btnAdd:"Lägg till",btnUnshare:"Sluta dela position",titleDialog:"Skriv nånting",btnCancel:"Avbryt",btnSubmit:"Skicka",loading:"Arbetar..."},en:{btnAdd:"Add tweet",btnUnshare:"Stop sharing position",titleDialog:"Write something",btnCancel:"Cancel",btnSubmit:"Submit",loading:"Working..."}},_setLang:function(t){t=t||smap.config.langCode||navigator.language.split("-")[0]||"en",this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){this.map=t,this._container=L.DomUtil.create("div","leaflet-control-sharetweet"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this._drawBtn(),this._addWfsLayer();var e=this;return this.map.on("zoomend moveend",function(){e.layer._refresh()}),this._container},onRemove:function(){},_notify:function(t,e){switch(e){case"success":e="alert-success";break;case"error":e="alert-danger"}var n=$('<div class="alert '+e+' alert-dismissable"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+t+"</div>");n.css({"margin-top":"20px"}),$(".modal-body").find(".alert").remove(),$(".modal-body .sharetweet-footer").before(n)},_addWfsLayer:function(){this.cluster=new L.MarkerClusterGroup,this.layer=smap.core.layerInst._createLayer({init:"L.GeoJSON.WFS",url:this.options.wfsSource,options:{layerId:"sharetweet-wfstlayer",displayName:"Tweets",featureType:this.options.wfsFeatureType,attribution:"Malmö stads WFS",inputCrs:"EPSG:4326",reverseAxis:!0,selectable:!0,popup:'<p class="lead">${text_text}</p><p>Skrivet den: <strong>${function(p) {var d = new Date(p.dtime_created);return d.toLocaleString();}}</strong></p>',uniqueAttr:null,hoverColor:"#FF0",style:{weight:6,color:"#F00",dashArray:"",fillOpacity:.5}}});var t=this;this.layer._map=this.map,this.layer.on("load",function(e){e.layer.eachLayer(function(e){t.cluster.addLayer(e)}),e.layer.clearLayers(),t.map.removeLayer(t.cluster),t.map.addLayer(t.cluster),smap.cmd.loading(!1)}),this.map.addLayer(this.cluster)},_onLocationFound:function(t){smap.cmd.loading(!1);var e=6;this.modal&&(this.modal.find('form td[name="easting"]').empty().text(utils.round(t.latlng.lng,e)),this.modal.find('form td[name="northing"]').empty().text(utils.round(t.latlng.lat,e)),this.modal.find('form td[name="accuracy"]').empty().text(utils.round(t.accuracy,1)+" m"),this.modal.find(".btn-primary").button("reset"))},_onLocationError:function(){var t=this;this._notify("Your position could not be determined","error"),setTimeout(function(){t.deactivate()
},3e3)},deactivate:function(){this.modal&&this.modal.modal("hide")},shareTweet:function(){$("#sharetweet-btn").button(this.lang.btnUnshare),smap.cmd.loading(!0),this.modal=this._showDialog(),this.modal.find(".btn-primary").button("loading");var t=smap.cmd.getControl("Geolocate");t&&t.deactivate(),this.map.on("locationfound",$.proxy(this._onLocationFound,this)),this.map.on("locationerror",$.proxy(this._onLocationError,this)),this.map.locate({watch:!0,setView:!0,enableHighAccuracy:!0}),smap.cmd.loading(!1)},unShareTweet:function(){$("#sharetweet-btn").button(this.lang.btnAdd),this.map.off("locationfound",$.proxy(this._onLocationFound,this)),this.map.off("locationerror",$.proxy(this._onLocationError,this))},_showDialog:function(){var t=$('<form id="sharetweet-form" role="form"><textarea class="form-control" rows="4" name="text" minlength="5" maxlength="140" required></textarea><table><tr><td>Easting:</td><td name="easting"></td></tr><tr><td>Northing:</td><td name="northing"></td></tr><tr style="font-weight:bold;"><td>Felmarginal:</td><td name="accuracy"></td></tr></table><div class="row sharetweet-footer"><button type="button" class="btn btn-default" data-dismiss="modal">'+this.lang.btnCancel+'</button><button type="submit" class="btn btn-primary" data-loading-text="'+this.lang.loading+'">'+this.lang.btnSubmit+"</button></div></form>"),e=this;t.on("submit",function(){var t=$(this).serializeArray(),n={};return $.each(t,function(t,e){n[e.name]=e.value}),n.easting=parseFloat($(this).find('[name="easting"]').text()),n.northing=parseFloat($(this).find('[name="northing"]').text()),e._save(L.latLng(n.northing,n.easting),n.text),!1}),t.find("tr").each(function(){var t=$(this).find("td:eq(1)");t.text(""),e._addSpin(t)});var n=utils.drawDialog(this.lang.titleDialog,t,null,{size:"sm"});return t.find(".btn-default").on("click",function(){return n.modal("hide"),!1}).find(".btn-primary").on("click",function(){return!1}),n.modal("show"),n.on("hidden.bs.modal",function(){e.map.stopLocate(),e.modal.empty().remove(),e.modal=null,$("#sharetweet-btn").button(this.lang.btnAdd),$("#sharetweet-btn").removeClass("btn-primary"),delete e.modal}),n},_addSpin:function(t){var e={length:5,width:1,radius:3},n=new Spinner(e).spin();$(t).append(n.el)},_drawBtn:function(){var t=this,e=$('<button id="sharetweet-btn" class="btn btn-default btn-lg"><span class="glyphicon glyphicon-map-marker"></span>&nbsp;&nbsp;<span>'+this.lang.btnAdd+"</span></button>");e.on("click",function(){$(this).hasClass("btn-primary")?($(this).removeClass("btn-primary"),t.unShareTweet()):($(this).addClass("btn-primary"),t.shareTweet())}),this.$container.append(e)},_createRequest:function(t,e){var n='<wfs:Transaction\n  service="WFS"\n  version="1.1.0"\n  xmlns:grp="http://localhost/"\n  xmlns:wfs="http://www.opengis.net/wfs"\n  xmlns:gml="http://www.opengis.net/gml"\n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  xsi:schemaLocation="http://www.opengis.net/wfs\n                      http://schemas.opengis.net/wfs/1.1.0/WFS-transaction.xsd\n                      '+this.options.wfsSource+"/DescribeFeatureType?typename="+this.options.wfsFeatureType+'">\n  <wfs:Insert>\n    <grp:tweets>\n      <grp:text_text>'+e.text+'</grp:text_text>\n      <grp:the_geom>\n        <gml:Point srsDimension="2" srsName="urn:x-ogc:def:crs:EPSG:4326">\n          <gml:coordinates decimal="." cs="," ts=" ">'+t.lat+","+t.lng+"</gml:coordinates>\n        </gml:Point>\n      </grp:the_geom>\n    </grp:tweets>\n  </wfs:Insert>\n</wfs:Transaction>";return n},_save:function(t,e){if(this.submitting)return!1;this.map.stopLocate(),this.submitting=!0,smap.cmd.loading(!0),this.modal.find(".btn-primary").button("loading");var n=this._createRequest(t,{text:e});$.ajax({url:smap.config.ws.proxy+encodeURIComponent(this.options.wfsSource),type:"POST",context:this,data:n,contentType:"text/xml",dataType:"text",success:function(t){smap.cmd.loading(!1);var e=$.xml2json(t);parseInt(e.TransactionSummary.totalInserted)>0&&(this.deactivate(),this._reload())},error:function(t,e){this._notify("Kunde inte spara. Fel: <strong>"+e+"</strong>","error"),smap.cmd.loading(!1)},complete:function(){this.modal.find(".btn-primary").button("reset"),this.submitting=!1}})},_reload:function(t){t=t||{},smap.cmd.loading(!0),this.layer._refresh()}}),L.control.shareTweet=function(t){return new L.Control.ShareTweet(t)},L.Control.ToolHandler=L.Control.extend({options:{position:"bottomright",showPopoverTitle:!0},_lang:{sv:{popoverTitle:"Verktyg"},en:{popoverTitle:"Tools"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(){var t=this;return t._container=L.DomUtil.create("div","leaflet-control-toolhandler"),L.DomEvent.disableClickPropagation(t._container),t.$container=$(t._container),t.$container.css("display","none"),this._makeToolHandler(),smap.event.on("smap.core.pluginsadded",function(){$(".leaflet-control").children("button").each(function(){t._addButton($(this))})}),t._container},activate:function(){},_makeToolHandler:function(){function t(){var t=$(".thandler-popover").length&&parseInt($(".thandler-popover").css("opacity")||0)>0,e=$(".popover-content");o.data("bs.popover")&&t&&e.children().length&&o.popover("hide")}function e(){var t=$(".thandler-container").children(":has('button')");t.length&&o.popover("show")}var n=this,a=$(".leaflet-top.leaflet-right");this.$thCont=a,a.addClass("thandler-container");var o=$('<div class="thandler-btn popover-dismiss"><button type="button" class="btn btn-default thbtn"><span class="fa fa-th"></span></button></div>');$("#mapdiv").append(o),this._map.on("click dragstart",t),$(window).on("orientationchange",t),o.on("click",function(){var a=$(this);if(a.data("bs.popover")){var o=$(".thandler-popover").length&&parseInt($(".thandler-popover").css("opacity")||0)>0;if(o)return void a.popover("hide")}else a.popover({content:null,placement:"bottom",title:n.lang.popoverTitle,trigger:"manual"}),a.on("shown.bs.popover",function(){var e=$(".popover"),a=$(".popover-content");n.options.showPopoverTitle||e.find("h3").remove(),e.addClass("thandler-popover"),a.append($(".thandler-container").children(":has('button')")),$(window).on("resize",t)}),a.on("hidden.bs.popover",function(){$(window).off("resize",t);var e=$(".popover-content");setTimeout(function(){$(".thandler-container").append(e.children())},150)});return e(),!1}),o.on("tap",function(){return!1}),o.on("dblclick",function(){return!1})},_addButton:function(){},_removeButton:function(){},onRemove:function(){}}),L.control.toolhandler=function(t){return new L.Control.ToolHandler(t)},L.Control.Zoombar=L.Control.extend({options:{position:"bottomright"},_lang:{sv:{exampleLabel:"Ett exempel"},en:{exampleLabel:"An example"}},_setLang:function(t){t=t||smap.config.langCode,this._lang&&(this.lang=this._lang?this._lang[t]:null)},initialize:function(t){L.setOptions(this,t),this._setLang(t.langCode)},onAdd:function(t){return this.map=t,this._container=L.DomUtil.create("div","leaflet-control-zoombar"),L.DomEvent.disableClickPropagation(this._container),this.$container=$(this._container),this.$container.addClass("btn-group-vertical"),this.$container.on("mousedown",function(){return!1}),this._createButtonZoomIn(),this._createButtonZoomUt(),this.__onZoomEnd=this.__onZoomEnd||$.proxy(this._onZoomEnd,this),this.map.on("zoomend",this.__onZoomEnd),this._container},_onZoomEnd:function(){this.map.getZoom()>=this.map.getMaxZoom()?this.$container.find("#zoombar-plus").addClass("disabled"):this.map.getZoom()<=this.map.getMinZoom()?this.$container.find("#zoombar-minus").addClass("disabled"):this.$container.find("button").removeClass("disabled")},_createButtonZoomIn:function(){var t=$('<button id="zoombar-plus" class="btn btn-default"><span class="fa fa-plus"></span></button>');this.$container.append(t);t.on("click touchstart dblclick",function(){return smap.map.zoomIn(),!1})},_createButtonZoomUt:function(){var t=$('<button id="zoombar-minus" class="btn btn-default"><span class="fa fa-minus"></span></button>');this.$container.append(t);t.on("click touchstart dblclick",function(){return smap.map.zoomOut(),!1})},onRemove:function(){}}),L.control.zoombar=function(t){return new L.Control.Zoombar(t)};